# AdvanceSDK对接文档-Android

版本号：v3.2.2

本文档为聚合sdk接入配置文档。用户可以参考[AdvanceSdkDemo](http://www.bayescom.com/download/sdk.php?sdk=advance_android)工程中的配置以及广告位接入代码进行开发。

目前聚合SDK支持管理的广告位类型为：

- 横幅广告位(Banner)： 广点通Banner2.0类型，穿山甲模板类型，Mercury

- 开屏广告位(Splash)：广点通，穿山甲，Mercury

- 插屏广告位（Interstitial)：广点通插屏2.0类型，穿山甲模板类型，Mercury

- 原生模板信息流广告位(NativeExpress): 广点通，穿山甲模板类型,Mercury

- 激励视频(RewardVideo)：广点通，穿山甲模板类型,Mercury

- 全屏视频(FullScreenVideo)：广点通，穿山甲

- 自定义广告：支持任意渠道的任意广告位，需要客户端适配开发。
  

## 1.聚合SDK工作流程

![](sequence.png)



## 1.SDK包导入

在工程中创建一个libs目录，拷贝集成SDK需要的库文件(请使用提供的sdk包保证版本一致)：

advancelib_x.x.x.aar(聚合SDK包 集成后apk增加约 0.1M)

mercurysdk_x.x.x.aar  （mercurySDK 集成后apk增加约 0.6M）

GDTSDK.unionNormal.4.174.1044.aar   （广点通SDK 集成后apk增加约 2M）

open_ad_sdk.aar （穿山甲SDK v3.0.0.1 集成后apk增加约 1.8M）

msa_mdid_1.0.13.aar (msa广告联盟SDK，用来获取Android10 以上的 OAID参数)

在工程的build.gradle中引入这些库，具体配置可以参考AdvanceSdkDemo工程的build.gradle设置。

```groovy
repositories {
    flatDir {
        dirs 'libs'
    }
}
    implementation(name: 'advancelib_3.2.2', ext: 'aar')
    implementation(name: 'open_ad_sdk', ext: 'aar')
    implementation(name: 'GDTSDK.unionNormal.4.174.1044', ext: 'aar')
    implementation(name: 'msa_mdid_1.0.13', ext: 'aar')
    
    //mercury 引入方式一：jcenter （推荐）
    implementation 'com.mercury:mercurysdk:3.1.6'
    //mercury 引入方式二：本地aar引入
    implementation(name: 'mercurysdk_3.1.6', ext: 'aar')
   

```


```
为了适配穿山甲SDK下载和安装相关功能，在工程中引用的包 com.android.support:support-v4:24.2.0 
使用24.2.0以及以上版本。
```

目前SDK支持Android 4.0 以及以上系统的 Android 设备。

## 2.SDK相关权限申请

要保证SDK能够正常工作需要申请必要的权限，如果targetSdkVersion>23还需要动态申请相关权限，具体实现可参见Demo工程 SplashActivity.java。

```Xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
<uses-permission android:name="android.permission.READ_PHONE_STATE" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />    <!-- 如果需要精确定位的话请加上此权限 -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />
<!--穿山甲相关-->
<uses-permission android:name="android.permission.GET_TASKS"/>
<!-- 如果有视频相关的广告且使用textureView播放，请务必添加，否则黑屏 -->
<uses-permission android:name="android.permission.WAKE_LOCK" />

```

## 3.oaid支持（Mercury SDK 需要）

Mercury SDK 在Android10 以上设备需要OAID才能正常下发广告。Mercury_3.1.5及以后版本 内置了 OAID 获取的功能（基于msa_1.0.13版本）。为了正常获取必须：

1.添加最新版本 OAID 包（msa_mdid_1.0.13.aar 或以上），最新包详见 [移动安全联盟 MSA 官网](https://msa-alliance.cn/col.jsp?id=120)。

2.在 assets 文件夹中添加文件 **supplierconfig.json**，这样才能正确获取到 OAID。

文件内容如下：（各个渠道有appid的话就填上去）

```
{
  "supplier":{
    "vivo":{
      "appid":""
    },
    "xiaomi":{
    },
    "huawei":{
    },
    "oppo":{
    }
  }
}
```

3.如果 OAID 包低于1.0.13版本或者  Mercury SDK低于 3.1.5版本，建议升级aar包版本。如果**坚持使用旧版本**，请**自己获取**到 OAID 后调用 `MercuryAD.setOAID(String oaid)`方法对 OAID 赋值。

另外开发者可以在**SDK初始化成功**以后调用 `MercuryAD.getOAID()` 方法获取 OAID 检查正确性，如果结果不正确，观察`logcat` 下 `[OAIDHelper]`日志信息，一般是OAID aar资源包未引入或supplierconfig.json配置问题。


## 4.AndroidManifest.xml配置

如果您打包 App 时的 targetSdkVersion >= 28：在AndroidManifest.xml 添加依赖声明 `uses-library android:name="org.apache.http.legacy" android:required="false"`
在application标签中添加 `android:usesCleartextTraffic="true"`，否则 SDK 无法工作，示例如下：

```xml
<application
    android:name=".DemoApplication"
    android:icon="@drawable/gdticon"
    android:label="@string/app_name"
    android:theme="@style/AppTheme"
    android:usesCleartextTraffic="true">

    <uses-library
        android:name="org.apache.http.legacy"
        android:required="false" />
    ... ...
  </application>
```

在AndroidManifest.xml中注册SDK相关的Activity和Service:

```xml
<!--广点通-->
<service 
    android:name="com.qq.e.comm.DownloadService" 
    android:exported="false" />
<activity 
    android:name="com.qq.e.ads.ADActivity" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<activity 
    android:name="com.qq.e.ads.PortraitADActivity" 
    android:screenOrientation="portrait" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<activity 
    android:name="com.qq.e.ads.LandscapeADActivity" 
    android:screenOrientation="landscape" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />


```

针对Andriod7.0以上文件访问兼容性配置，在AndroidManifest.xml中增加：

```xml
<!--穿山甲-->
<provider
    android:name="com.bytedance.sdk.openadsdk.TTFileProvider"
    android:authorities="${applicationId}.TTFileProvider"
    android:exported="false"
    android:grantUriPermissions="true">
   <meta-data
        android:name="android.support.FILE_PROVIDER_PATHS"
        android:resource="@xml/file_paths" />
</provider>
<provider
    android:name="com.bytedance.sdk.openadsdk.multipro.TTMultiProvider"
    android:authorities="${applicationId}.TTMultiProvider"
    android:exported="false" />
<!--广点通-->
 <provider
        android:name="android.support.v4.content.FileProvider"
        android:authorities="${applicationId}.fileprovider"
        android:exported="false"
        android:grantUriPermissions="true">
        <meta-data
            android:name="android.support.FILE_PROVIDER_PATHS"
            android:resource="@xml/gdt_file_path" />
    </provider>
```

在res/xml目录下，新建穿山甲xml文件file_paths.xml，在该文件中添加如下代码：

```xml
<?xml version="1.0" encoding="utf-8"?>  
<paths xmlns:android="http://schemas.android.com/apk/res/android">  
   <external-files-path name="external_files_path" path="Download" />  
    <!--为了适配所有路径可以设置 path = "." -->  
</paths>
```

在res/xml目录下，新建广点通配置gdt_file_path.xml,在文件中添加如下代码:

```xml
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- 这个下载路径也不可以修改，必须为GDTDOWNLOAD -->
    <external-path
        name="gdt_sdk_download_path"
        path="GDTDOWNLOAD" />
    <external-files-path
        name="external_files_path"
        path="Download" />
    <external-path
        name="download"
        path="." />
    <external-cache-path
        name="gdt_sdk_download_path1"
        path="com_qq_e_download" />
    <cache-path
        name="gdt_sdk_download_path2"
        path="com_qq_e_download" />
</paths>
```

## 5.代码混淆配置

如果您需要使用proguard混淆代码，需确保不要混淆SDK的代码。 请在proguard.cfg文件(或其他混淆文件)尾部添加如下配置:

```
-keep class com.bytedance.sdk.openadsdk.** { *; }
-keep public interface com.bytedance.sdk.openadsdk.downloadnew.** {*;}
-keep class com.ss.sys.ces.* {*;}
-keep class com.qq.e.** { 
    public protected *; 
}
-keep class android.support.v4.app.NotificationCompat**{
    public *;
}
-keep class com.bun.miitmdid.core.** {*;}

```

**注意**:SDK代码被混淆后会导致广告无法展现或者其它异常。

**注意**:SDK中使用的so文件支持四种架构：x86,x86_64,armeabi-v7a,arm64-v8a, 如果您应用中支持的架构超出这 四种，请在build.gradle中使用abiFilters选择支持的架构。如下所示： ndk { // 设置支持的 SO 库构架，注意这里要根据你的实际情况来设置 abiFilters ‘armeabi-v7a’, ‘arm64-v8a’, ‘x86’, ‘x86_64’ }

## 6.广告位接入代码示例

具体可运行的代码可以参考AdvanceDemo工程。

app启动时需要设置聚合SDK相关初始化代码：

```java
public class MyApplication extends Application {
    @Override
    public void onCreate() {
        super.onCreate();
        
        //聚合SDK初始化
         AdvanceConfig.getInstance()
                       .setDebug(true)//设置debug模式
                       .setNeedPermissionCheck(true)//设置是否在请求穿山甲sdk广告前校验权限，防止无权限不返回广告，默认为false不去校验。
                        //设置各个sdk的媒体id，目前后台也可以配置，后续会去掉后台的配置入口，统一在这里设置。
                       .setCsjAppId("你在穿山甲后台申请的的appId")
                       .setGdtMediaId("你在广点通后台申请的的MediaId")
                       .setMercuryMediaId("你在Mercury后台申请的的MediaId")
                       .setMercuryMediaKey("你在Mercury后台申请的的MediaKey")
                       .initSDKs(this);       

        }
    }
    
```



### 6.1横幅(Banner)

支持广点通，穿山甲，Mercury横幅广告位。

```java
public class BannerActivity extends AppCompatActivity implements AdvanceBannerListener {
    private String TAG = "DEMO BANNER";
    private AdvanceBanner advanceBanner;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_banner);
        RelativeLayout rl = findViewById(R.id.banner_layout);
        advanceBanner = new AdvanceBanner(this, rl, ADManager.getInstance().getBannerAdspotId());

        //可选：个性化设置，穿山甲个性化模板广告的尺寸属性，期望模板广告view的size，刷新间隔（s）
        advanceBanner.setCsjExpressViewAcceptedSize(640, 100)
                .setRefreshInterval(60);
        //推荐：核心事件监听回调
        advanceBanner.setAdListener(this);
        //推荐：设置是否开启策略缓存
        advanceBanner.enableStrategyCache(true);
        //必须：设置打底SDK参数
        advanceBanner.setDefaultSdkSupplier(new SdkSupplier("10000396", AdvanceSupplierID.MERCURY));
        advanceBanner.loadAd();

    }

    @Override
    public void onAdShow() {
        Log.d(TAG, "SHOW");
        Toast.makeText(this, "广告展现", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdFailed() {

        Log.d(TAG, "Failed");
        Toast.makeText(this, "广告失败", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdClicked() {
        Log.d(TAG, "Clicked");
        Toast.makeText(this, "广告点击", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onDislike() {
        RelativeLayout rl = findViewById(R.id.banner_layout);
        rl.removeAllViews();
        Toast.makeText(this, "广告关闭", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onDestroy() {
        super.onDestroy();
        advanceBanner.destroy();

    }
}
```

### 6.2开屏(Splash)

支持广点通，穿山甲，Mercury开屏广告位。

```java
public class SplashActivity extends Activity implements AdvanceSplashListener, WeakHandler.IHandler {
    private AdvanceSplash advanceSplash;
    private final WeakHandler mHandler = new WeakHandler(this);
    private static final int MSG_GO_MAIN = 1;
    private boolean canJump = false;
    private String sdkId;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_splash);
        FrameLayout adContainer = findViewById(R.id.splash_container);
        TextView skipView = findViewById(R.id.skip_view);
        View skipCT = findViewById(R.id.splash_skip_container);

        //开屏初始化；adContainer为广告容器，skipView不需要自定义可以为null
        advanceSplash = new AdvanceSplash(this, ADManager.getInstance().getSplashAdspotId(), adContainer, skipView);
        //可选：设置mercury开屏底部logo
        advanceSplash.setLogoImage(this.getResources().getDrawable(R.mipmap.logo));
        //可选：设置mercury开屏加载时占位图
        advanceSplash.setHolderImage(this.getResources().getDrawable(R.mipmap.background));
        //可选：设置跳过字体，穿山甲广告尺寸，核心事件回调
        advanceSplash.setSkipText("%d s|跳过")
                .setCsjAcceptedSize(1080, 1920);//设置穿山甲广告图片偏好尺寸(如果接入穿山甲的话
        //可选：设置广点通的跳过载体，传入一个默认可见view给广点通进行可见检查机制
        advanceSplash.setGdtSkipContainer(skipCT);
        //可选：设置广点通的广告点击后是否以onAdSkip(跳过事件)来回调，适合跳过和倒计时结束处理逻辑不同时设置，处理逻辑相同请忽略。true 点击广点通广告关闭后回调onAdSkip，false 回调 onAdTimeOver；默认为false。
        advanceSplash.setGdtClickAsSkip(true);
        //推荐：设置开屏核心回调事件的监听器。
        advanceSplash.setAdListener(this);
        //强烈推荐：设置是否将获取到的SDK选择策略进行缓存，有助于缩短开屏广告加载时间
        advanceSplash.enableStrategyCache(true);
        //必须：设置打底sdk参数（当策略服务有问题的话，会使用 该sdk的参数)
        advanceSplash.setDefaultSdkSupplier(new SdkSupplier("887301946", AdvanceSupplierID.CSJ));
        // 如果targetSDKVersion >= 23，就要申请好权限。如果您的App没有适配到Android6.0（即targetSDKVersion < 23），那么只需要在这里直接调用fetchSplashAD接口。
        if (Build.VERSION.SDK_INT >= 23) {
            checkAndRequestPermission();
        } else {
            advanceSplash.loadAd();
        }

    }

    @Override
    public void onAdShow() {
        Log.d("DEMO", "Splash ad show");
        Toast.makeText(this, "广告展示成功", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdFailed() {
        Log.d("DEMO", "Splash ad failed");
        Toast.makeText(this, "广告加载失败", Toast.LENGTH_SHORT).show();
        goToMainActivity();


    }

    @Override
    public void onAdClicked() {
        Log.d("DEMO", "Splash ad clicked");
        Toast.makeText(this, "广告点击", Toast.LENGTH_SHORT).show();

    }

//    @Override
//    public void onAdClose() {
//        Log.d("DEMO", "Splash ad closed");
////        Toast.makeText(this,"广告关闭",Toast.LENGTH_SHORT).show();
//
//        mHandler.sendEmptyMessageDelayed(MSG_GO_MAIN,100);
//    }

    @Override
    public void onAdSkip() {

        Log.d("DEMO", "Splash ad kip");
        Toast.makeText(this, "跳过广告", Toast.LENGTH_SHORT).show();
        mHandler.sendEmptyMessageDelayed(MSG_GO_MAIN, 100);
    }

    @Override
    public void onAdTimeOver() {
        Log.d("DEMO", "Splash ad timeOver");
        Toast.makeText(this, "倒计时结束，关闭广告", Toast.LENGTH_SHORT).show();
        mHandler.sendEmptyMessageDelayed(MSG_GO_MAIN, 100);
    }

    @Override
    public void onSdkSelected(String id) {
        // "1" 代表mercury策略 ，"2" 代表广点通策略， "3" 代表穿山甲策略
        sdkId = id;
        Log.d("DEMO", "Splash ad onSdkSelected " + id);
        Toast.makeText(this, "策略选中，选中SDK id = " + id, Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdLoaded() {
        Log.d("DEMO", "Splash ad onAdLoaded");
        Toast.makeText(this, "广告加载成功", Toast.LENGTH_SHORT).show();
    }

    /**
     * ----------非常重要----------
     * <p>
     * Android6.0以上的权限适配简单示例：
     * <p>
     * 如果targetSDKVersion >= 23，那么必须要申请到所需要的权限，再调用广点通SDK，否则广点通SDK不会工作。
     * <p>
     * Demo代码里是一个基本的权限申请示例，请开发者根据自己的场景合理地编写这部分代码来实现权限申请。
     * 注意：下面的`checkSelfPermission`和`requestPermissions`方法都是在Android6.0的SDK中增加的API，如果您的App还没有适配到Android6.0以上，则不需要调用这些方法，直接调用即可。
     */
    @TargetApi(Build.VERSION_CODES.M)
    private void checkAndRequestPermission() {
        List<String> lackedPermission = new ArrayList<String>();
        if (!(checkSelfPermission(Manifest.permission.READ_PHONE_STATE) == PackageManager.PERMISSION_GRANTED)) {
            lackedPermission.add(Manifest.permission.READ_PHONE_STATE);
        }

        if (!(checkSelfPermission(Manifest.permission.WRITE_EXTERNAL_STORAGE) == PackageManager.PERMISSION_GRANTED)) {
            lackedPermission.add(Manifest.permission.WRITE_EXTERNAL_STORAGE);
        }


        // 权限都已经有了，那么直接调用SDK
        if (lackedPermission.size() == 0) {
            advanceSplash.loadAd();

        } else {
            // 请求所缺少的权限，在onRequestPermissionsResult中再看是否获得权限，如果获得权限就可以调用SDK，否则不要调用SDK。
            String[] requestPermissions = new String[lackedPermission.size()];
            lackedPermission.toArray(requestPermissions);
            requestPermissions(requestPermissions, 1024);
        }
    }

    private boolean hasAllPermissionsGranted(int[] grantResults) {
        for (int grantResult : grantResults) {
            if (grantResult == PackageManager.PERMISSION_DENIED) {
                return false;
            }
        }
        return true;
    }

    @Override
    public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == 1024 && hasAllPermissionsGranted(grantResults)) {
            advanceSplash.loadAd();

        } else {
            // 如果用户没有授权，那么应该说明意图，引导用户去设置里面授权。
            Toast.makeText(this, "应用缺少必要的权限！请点击\"权限\"，打开所需要的权限。", Toast.LENGTH_LONG).show();
            Intent intent = new Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);
            intent.setData(Uri.parse("package:" + getPackageName()));
            startActivity(intent);
            finish();
        }
    }

    /**
     * 设置一个变量来控制当前开屏页面是否可以跳转，当开屏广告为普链类广告时，点击会打开一个广告落地页，此时开发者还不能打开自己的App主页。当从广告落地页返回以后，
     * 才可以跳转到开发者自己的App主页；当开屏广告是App类广告时只会下载App。
     */
    private void next() {
        if (canJump) {
            goToMainActivity();
        } else {
            canJump = true;
        }
    }

    @Override
    protected void onPause() {
        super.onPause();
        // 穿山甲处理逻辑,h5类型的广告，跳转后返回不会回调onAdTimeOver或者onAdTimeOver，会导致无法跳转首页，需要在这里额外处理跳转逻辑
        if (TextUtils.equals(sdkId, "3")) {
            canJump = true;
        } else {
            canJump = false;
        }
    }

    @Override
    protected void onResume() {
        super.onResume();
        if (canJump) {
            next();
        }
        canJump = true;
    }


    @Override
    protected void onDestroy() {
        super.onDestroy();
        mHandler.removeCallbacksAndMessages(null);
    }

    /**
     * 开屏页一定要禁止用户对返回按钮的控制，否则将可能导致用户手动退出了App而广告无法正常曝光和计费
     */
    @Override
    public boolean onKeyDown(int keyCode, KeyEvent event) {
        if (keyCode == KeyEvent.KEYCODE_BACK || keyCode == KeyEvent.KEYCODE_HOME) {
            return true;
        }
        return super.onKeyDown(keyCode, event);
    }

    /**
     * 跳转到主页面
     */
    private void goToMainActivity() {
//        Intent intent = new Intent(SplashActivity.this, MainActivity.class);
//        intent.setFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);
//        startActivity(intent);
        this.finish();
    }

    @Override
    public void handleMsg(Message msg) {
        if (msg.what == MSG_GO_MAIN) {
            next();
        }
    }
}
```

### 6.3插屏(Interstitial)

支持广点通，穿山甲，Mercury插屏广告。



```java
public class InterstitialActivity extends AppCompatActivity implements AdvanceInterstitialListener, UnifiedInterstitialMediaListener {
    private AdvanceInterstitial advanceInterstitial;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_interstitial);
        advanceInterstitial = new AdvanceInterstitial(this, ADManager.getInstance().getInterstitialAdspotId());
        //必须：期望模板广告view的size,单位dp。高度为0代表自适应
        advanceInterstitial.setCsjExpressViewAcceptedSize(300, 300);
        //必须：设置打底SDK参数
        advanceInterstitial.setDefaultSdkSupplier(new SdkSupplier(   "10000398", AdvanceSupplierID.MERCURY));
        //推荐：设置是否采用策略缓存
        advanceInterstitial.enableStrategyCache(true);
        //推荐：核心事件监听回调
        advanceInterstitial.setAdListener(this);
        //可选，设置广点通的视频广告的播放回调，不需要可忽略。
        advanceInterstitial.setGdtMediaListener(this);
    }

    public void showAd(View view) {
        advanceInterstitial.show();
    }

    @Override
    public void onAdClose() {
        Toast.makeText(this, "广告关闭", Toast.LENGTH_SHORT).show();

    }


    @Override
    public void onAdReady() {
        Toast.makeText(this, "广告就绪", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdShow() {

        Toast.makeText(this, "广告展示", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdFailed() {

        Toast.makeText(this, "广告失败", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdClicked() {

        Toast.makeText(this, "广告点击", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onDestroy() {
        super.onDestroy();
        advanceInterstitial.destroy();
    }

    public void loadAd(View view) {
        advanceInterstitial.loadAd();

    }

    // 以下是广点通视频广告的相关回调
    @Override
    public void onVideoInit() {

    }

    @Override
    public void onVideoLoading() {

    }

    @Override
    public void onVideoReady(long l) {

    }

    @Override
    public void onVideoStart() {

    }

    @Override
    public void onVideoPause() {

    }

    @Override
    public void onVideoComplete() {

    }

    @Override
    public void onVideoError(AdError adError) {

    }

    @Override
    public void onVideoPageOpen() {

    }

    @Override
    public void onVideoPageClose() {

    }
}
```

### 6.4原生模板(NativeExpress)

支持广点通，穿山甲,Mercury原生模板广告位。广告数据加载后需要转换为：GdtNativeAdExpressAdItem或者CsjNativeExpressAdItem，MercuryNativeExptessItem包装类进行操作，包装类包装了原始的广点通和穿山甲模板广告位API。

RecyclerView中使用的话请参考示例工程中的NativeExpressRecyclerViewActivity。

```java
public class NativeExpressRecyclerViewActivity extends Activity implements
        AdvanceNativeExpressListener {

    private static final String TAG = NativeExpressRecyclerViewActivity.class.getSimpleName();
    public static final int MAX_ITEMS = 50;
    public static int FIRST_AD_POSITION = 1; // 第一条广告的位置
    public static int ITEMS_PER_AD = 10;     // 每间隔10个条目插入一条广告

    private RecyclerView mRecyclerView;
    private CustomAdapter mAdapter;
    private List<NormalItem> mNormalDataList = new ArrayList<>();
    private AdvanceNativeExpress mADManager;
    private List<AdvanceNativeExpressAdItem> mAdItemList;
    private HashMap<View, Integer> mAdViewPositionMap = new HashMap<>();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        requestWindowFeature(Window.FEATURE_NO_TITLE);
        setContentView(R.layout.activity_native_express_recycler_view);
        mRecyclerView = findViewById(R.id.recycler_view);
        mRecyclerView.setHasFixedSize(true);
        mRecyclerView.setLayoutManager(new LinearLayoutManager(this));
        initData();
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();

        // 使用完了每一个NativeExpressADView之后都要释放掉资源。
        if (mAdItemList != null) {
            for (AdvanceNativeExpressAdItem item : mAdItemList) {
                item.destroy();
            }
        }
    }

    private void initData() {
        for (int i = 0; i < MAX_ITEMS; ++i) {
            mNormalDataList.add(new NormalItem("No." + i + " Normal Data"));
        }
        mAdapter = new CustomAdapter(mNormalDataList);
        mRecyclerView.setAdapter(mAdapter);
        initAdvanceNativeExpressAD();
    }

    /**
     *
     */
    private void initAdvanceNativeExpressAD() {
        mADManager = new AdvanceNativeExpress(this, ADManager.getInstance().getNativeExpressAdspotId());
        //可选：设置定制化参数
        mADManager.setExpressViewAcceptedSize(600, 250)
                .setGdtFullWidth(true)
                .setGdtAutoHeight(true)
                .setCsjImageAcceptedSize(640, 320);
        //推荐：核心事件监听回调
        mADManager.setAdListener(this);
        //推荐：设置是否采用策略缓存
        mADManager.enableStrategyCache(true);
        //必须：设置打底SDK参数
        mADManager.setDefaultSdkSupplier(new SdkSupplier("10002678", AdvanceSupplierID.MERCURY));
        mADManager.loadAd();
    }
    //AdvanceSDK回调接口

    @Override
    public void onAdShow(View view) {
        Toast.makeText(this, "广告展示", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdFailed() {
        Toast.makeText(this, "广告失败", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdRenderFailed(View view) {
        Toast.makeText(this, "广告渲染失败", Toast.LENGTH_SHORT).show();
        Log.i(TAG, "onADRenderFail: " + view.toString());
        if (mAdapter != null) {
            int removedPosition = mAdViewPositionMap.get(view);
            mAdapter.removeADView(removedPosition);
        }
        mAdViewPositionMap.remove(view);
    }

    @Override
    public void onAdRenderSuccess(View view) {

    }

    @Override
    public void onAdClicked(View view) {

        Toast.makeText(this, "广告点击", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdClose(View view) {
        Toast.makeText(this, "广告关闭", Toast.LENGTH_SHORT).show();
        Log.i(TAG, "onADClosed: " + view.toString());
        if (mAdapter != null) {
            int removedPosition = mAdViewPositionMap.get(view);
            mAdapter.removeADView(removedPosition);
        }
        mAdViewPositionMap.remove(view);

    }

    @Override
    public void onAdLoaded(List<AdvanceNativeExpressAdItem> list) {
        Toast.makeText(this, "广告加载完成", Toast.LENGTH_SHORT).show();
        mAdItemList = list;
        for (int i = 0; i < mAdItemList.size(); i++) {
            int position = FIRST_AD_POSITION + ITEMS_PER_AD * i;
            if (position < mNormalDataList.size()) {
                AdvanceNativeExpressAdItem item = mAdItemList.get(i);
                if (AdvanceConfig.SDK_ID_GDT.equals(item.getSdkId())) {
                    GdtNativeAdExpressAdItem gdtNativeAdExpressAdItem = (GdtNativeAdExpressAdItem) item;
                    if (gdtNativeAdExpressAdItem.getBoundData().getAdPatternType() == AdPatternType.NATIVE_VIDEO) {
                        gdtNativeAdExpressAdItem.setMediaListener(new NativeExpressMediaListener() {
                            @Override
                            public void onVideoInit(NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoLoading(NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoCached(NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoReady(NativeExpressADView nativeExpressADView, long l) {

                            }

                            @Override
                            public void onVideoStart(NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoPause(NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoComplete(NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoError(NativeExpressADView nativeExpressADView, AdError adError) {

                            }

                            @Override
                            public void onVideoPageOpen(NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoPageClose(NativeExpressADView nativeExpressADView) {

                            }
                        });
                    }
                }
                if (AdvanceConfig.SDK_ID_MERCURY.equals((item.getSdkId()))) {
                    MercuryNativeExpressAdItem mercuryNativeExpressAdItem = (MercuryNativeExpressAdItem) item;
                    if (mercuryNativeExpressAdItem.getAdPatternType() == com.mercury.sdk.core.config.AdPatternType.NATIVE_VIDEO_2TEXT ||
                            mercuryNativeExpressAdItem.getAdPatternType() == com.mercury.sdk.core.config.AdPatternType.NATIVE_1VIDEO_1ICON_2TEXT) {
                        mercuryNativeExpressAdItem.setMediaListener(new com.mercury.sdk.core.nativ.NativeExpressMediaListener() {
                            @Override
                            public void onVideoInit(com.mercury.sdk.core.nativ.NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoLoading(com.mercury.sdk.core.nativ.NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoReady(com.mercury.sdk.core.nativ.NativeExpressADView nativeExpressADView, long l) {

                            }

                            @Override
                            public void onVideoStart(com.mercury.sdk.core.nativ.NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoPause(com.mercury.sdk.core.nativ.NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoComplete(com.mercury.sdk.core.nativ.NativeExpressADView nativeExpressADView) {

                            }

                            @Override
                            public void onVideoError(com.mercury.sdk.core.nativ.NativeExpressADView nativeExpressADView, ADError adError) {

                            }
                        });
                    }

                } else if (AdvanceConfig.SDK_ID_CSJ.equals(item.getSdkId())) {

                    CsjNativeExpressAdItem csjNativeExpressAdItem = (CsjNativeExpressAdItem) item;
                    //设置穿山甲广告交互监听器(必须)
                    csjNativeExpressAdItem.setExpressInteractionListener(new TTNativeExpressAd.ExpressAdInteractionListener() {
                        @Override
                        public void onAdClicked(View view, int i) {

                        }

                        @Override
                        public void onAdShow(View view, int i) {

                        }

                        @Override
                        public void onRenderFail(View view, String s, int i) {

                        }

                        @Override
                        public void onRenderSuccess(View view, float v, float v1) {

                        }
                    });
                    //设置穿山甲SDK关闭监听器
                    csjNativeExpressAdItem.setDislikeCallback(this, new TTAdDislike.DislikeInteractionCallback() {
                        @Override
                        public void onSelected(int i, String s) {
                            Toast.makeText(NativeExpressRecyclerViewActivity.this, s, Toast.LENGTH_SHORT).show();
                        }

                        @Override
                        public void onCancel() {

                        }
                    });
                }

                mAdViewPositionMap.put(item.getExpressAdView(), position); // 把每个广告在列表中位置记录下来
                mAdapter.addADItemToPosition(position, mAdItemList.get(i));
            }
        }
        mAdapter.notifyDataSetChanged();

    }

    public class NormalItem {
        private String title;

        public NormalItem(String title) {
            this.title = title;
        }

        public String getTitle() {
            return title;
        }

        public void setTitle(String title) {
            this.title = title;
        }
    }

    /**
     * RecyclerView的Adapter
     */
    class CustomAdapter extends RecyclerView.Adapter<CustomAdapter.CustomViewHolder> {

        static final int TYPE_DATA = 0;
        static final int TYPE_AD = 1;
        private List<Object> mData;

        public CustomAdapter(List list) {
            mData = list;
        }

        // 把返回的NativeExpressADView添加到数据集里面去
        public void addADItemToPosition(int position, AdvanceNativeExpressAdItem adItem) {
            if (position >= 0 && position < mData.size() && adItem != null) {
                mData.add(position, adItem);
            }
        }

        // 移除NativeExpressADView的时候是一条一条移除的
        public void removeADView(int position) {
            mData.remove(position);
            mAdapter.notifyItemRemoved(position); // position为adView在当前列表中的位置
            mAdapter.notifyItemRangeChanged(0, mData.size() - 1);
        }

        @Override
        public int getItemCount() {
            if (mData != null) {
                return mData.size();
            } else {
                return 0;
            }
        }

        @Override
        public int getItemViewType(int position) {
            return mData.get(position) instanceof AdvanceNativeExpressAdItem ? TYPE_AD : TYPE_DATA;
        }

        @Override
        public void onBindViewHolder(final CustomViewHolder customViewHolder, final int position) {
            int type = getItemViewType(position);
            if (TYPE_AD == type) {
                final AdvanceNativeExpressAdItem advanceNativeExpressAdItem = (AdvanceNativeExpressAdItem) mData.get(position);
                mAdViewPositionMap.put(advanceNativeExpressAdItem.getExpressAdView(), position); // 广告在列表中的位置是可以被更新的


                if (AdvanceConfig.SDK_ID_GDT.equals(advanceNativeExpressAdItem.getSdkId())) {
                    //广点通adview渲染方式
                    GdtNativeAdExpressAdItem gdtNativeAdExpressAdItem = (GdtNativeAdExpressAdItem) advanceNativeExpressAdItem;
                    NativeExpressADView adView = gdtNativeAdExpressAdItem.getNativeExpressADView();
                    if (customViewHolder.container.getChildCount() > 0
                            && customViewHolder.container.getChildAt(0) == adView) {
                        return;
                    }

                    if (customViewHolder.container.getChildCount() > 0) {
                        customViewHolder.container.removeAllViews();
                    }
                    if (adView.getParent() != null) {
                        ((ViewGroup) adView.getParent()).removeView(adView);
                    }

                    customViewHolder.container.addView(adView);
                    adView.render(); // 调用render方法后sdk才会开始展示广告
                } else if (AdvanceConfig.SDK_ID_MERCURY.equals(advanceNativeExpressAdItem.getSdkId())) {
                    MercuryNativeExpressAdItem mercuryNativeExpressAdItem = (MercuryNativeExpressAdItem) advanceNativeExpressAdItem;
                    com.mercury.sdk.core.nativ.NativeExpressADView adView = mercuryNativeExpressAdItem.getNativeExpressADView();
                    if (customViewHolder.container.getChildCount() > 0
                            && customViewHolder.container.getChildAt(0) == adView) {
                        return;
                    }

                    if (customViewHolder.container.getChildCount() > 0) {
                        customViewHolder.container.removeAllViews();
                    }
                    if (adView.getParent() != null) {
                        ((ViewGroup) adView.getParent()).removeView(adView);
                    }

                    customViewHolder.container.addView(adView);
                    adView.render();

                } else if (AdvanceConfig.SDK_ID_CSJ.equals(advanceNativeExpressAdItem.getSdkId())) {
                    //穿山甲渲染方式
                    CsjNativeExpressAdItem csjNativeExpressAdItem = (CsjNativeExpressAdItem) advanceNativeExpressAdItem;
                    View adView = csjNativeExpressAdItem.getExpressAdView();
                    if (customViewHolder.container.getChildCount() > 0
                            && customViewHolder.container.getChildAt(0) == adView) {
                        return;
                    }

                    if (customViewHolder.container.getChildCount() > 0) {
                        customViewHolder.container.removeAllViews();
                    }
                    if (adView.getParent() != null) {
                        ((ViewGroup) adView.getParent()).removeView(adView);
                    }

                    customViewHolder.container.addView(adView);

                    csjNativeExpressAdItem.render(); //调用穿山甲render渲染方法

                }
            } else {
                customViewHolder.title.setText(((NormalItem) mData.get(position)).getTitle());
            }
        }

        @Override
        public CustomViewHolder onCreateViewHolder(ViewGroup viewGroup, int viewType) {
            int layoutId = (viewType == TYPE_AD) ? R.layout.item_express_ad : R.layout.item_data;
            View view = LayoutInflater.from(viewGroup.getContext()).inflate(layoutId, null);
            CustomViewHolder viewHolder = new CustomViewHolder(view);
            return viewHolder;
        }

        class CustomViewHolder extends RecyclerView.ViewHolder {
            public TextView title;
            public ViewGroup container;

            public CustomViewHolder(View view) {
                super(view);
                title = (TextView) view.findViewById(R.id.title);
                container = (ViewGroup) view.findViewById(R.id.express_ad_container);
            }
        }
    }


}
```



### 6.5激励视频(RewardVideo)

支持广点通，穿山甲，Mercury SDK。激励视频需要预先加载，可以在广告缓存成功后展示。广点通激励视频广告展示有过期时间，请尽快在缓存成功后展示广告。

```java
public class RewardVideoActivity extends AppCompatActivity implements AdvanceRewardVideoListener {
    private AdvanceRewardVideo advanceRewardVideo;
    private AdvanceRewardVideoItem advanceRewardVideoItem;
    private boolean isReady = false;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_reward_video);
        advanceRewardVideo = new AdvanceRewardVideo(this, ADManager.getInstance().getRewardAdspotId());
        //可选：设置穿山甲相关参数(如果有的话)
        advanceRewardVideo.setCsjImageAcceptedSize(1080, 1920);
        advanceRewardVideo.setCsjRewardName("金币");
        advanceRewardVideo.setOrientation(AdvanceRewardVideo.ORIENTATION_HORIZONTAL);
        advanceRewardVideo.setCsjUserId("user123");
        advanceRewardVideo.setCsjRewardAmount(Toast.LENGTH_SHORT);
        //推荐：设置是否采用策略缓存
        advanceRewardVideo.enableStrategyCache(true);
        //必须：设置打底广告
        advanceRewardVideo.setDefaultSdkSupplier(new SdkSupplier("2090845242931421", AdvanceSupplierID.GDT));
        //设置通用事件监听器
        advanceRewardVideo.setAdListener(this);

    }

    public void onLoad(View view) {
        isReady = false;
        advanceRewardVideo.loadAd();

    }

    public void onShow(View view) {
        if (isReady) {
            //穿山甲SDK特定设置
            if (AdvanceConfig.SDK_ID_CSJ.equals(advanceRewardVideoItem.getSdkId())) {
                CsjRewardVideoAdItem csjRewardVideoAdItem = (CsjRewardVideoAdItem) advanceRewardVideoItem;
                //设置穿山甲SDK监听器（必须），可以监听穿山甲sdk特定回调,通用的回调同时会回调通用监听器
                csjRewardVideoAdItem.setRewardAdInteractionListener(new TTRewardVideoAd.RewardAdInteractionListener() {
                    @Override
                    public void onAdShow() {

                    }

                    @Override
                    public void onAdVideoBarClick() {

                    }

                    @Override
                    public void onAdClose() {

                    }

                    @Override
                    public void onVideoComplete() {

                    }

                    @Override
                    public void onVideoError() {

                    }

                    @Override
                    public void onRewardVerify(boolean b, int i, String s) {

                    }

                    @Override
                    public void onSkippedVideo() {

                    }
                });
                csjRewardVideoAdItem.setShowDownLoadBar(true);

                csjRewardVideoAdItem.setDownloadListener(new TTAppDownloadListener() {
                    @Override
                    public void onIdle() {

                    }

                    @Override
                    public void onDownloadActive(long l, long l1, String s, String s1) {

                    }

                    @Override
                    public void onDownloadPaused(long l, long l1, String s, String s1) {

                    }

                    @Override
                    public void onDownloadFailed(long l, long l1, String s, String s1) {

                    }

                    @Override
                    public void onDownloadFinished(long l, String s, String s1) {

                    }

                    @Override
                    public void onInstalled(String s, String s1) {

                    }
                });
            }
            //展示广告
            advanceRewardVideoItem.showAd();
        } else {
            Toast.makeText(this, "广告未加载", Toast.LENGTH_SHORT).show();
        }

    }

    @Override
    public void onAdShow() {
        Log.d("DEMO", "SHOW");
        Toast.makeText(this, "广告展示", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdFailed() {
        Log.d("DEMO", "FAILED");
        Toast.makeText(this, "广告加载失败", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdClicked() {
        Log.d("DEMO", "CLICKED");
        Toast.makeText(this, "广告点击", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdLoaded(AdvanceRewardVideoItem advanceRewardVideoItem) {
        Log.d("DEMO", "LOADED");
        this.advanceRewardVideoItem = advanceRewardVideoItem;
        Toast.makeText(this, "广告加载成功", Toast.LENGTH_SHORT).show();


    }

    @Override
    public void onVideoCached() {
        Log.d("DEMO", "CACHED");
        isReady = true;
        Toast.makeText(this, "广告缓存成功", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onVideoComplete() {
        Log.d("DEMO", "VIDEO COMPLETE");
        Toast.makeText(this, "视频播放完毕", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdClose() {
        Log.d("DEMO", "AD CLOSE");

        Toast.makeText(this, "广告关闭", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void onAdReward() {
        Log.d("DEMO", "AD REWARD");
        Toast.makeText(this, "激励发放", Toast.LENGTH_SHORT).show();

    }

}

```


### 6.6 全屏视频(FullScreenVideo)

支持广点通，穿山甲。穿山甲可以在视频缓存成功后再展示，广点通目前没有视频预缓存，广告加载成功即可展示。

```java
public class FullScreenVideoActivity extends Activity implements AdvanceFullScreenVideoListener {

    AdvanceFullScreenVideo advanceFullScreenVideo;
    AdvanceFullScreenItem advanceFullScreenItem;
    boolean isReady = false;
    String TAG = FullScreenVideoActivity.class.getSimpleName();

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_full_screen_video);

        advanceFullScreenVideo = new AdvanceFullScreenVideo(this, ADManager.getInstance().getFullScreenVideoAdspotId());
        //推荐：核心事件监听回调
        advanceFullScreenVideo.setAdListener(this);
        //必须：设置打底SDK参数
        advanceFullScreenVideo.setDefaultSdkSupplier(new SdkSupplier("945065337", AdvanceSupplierID.CSJ));
        //可选： 设置广点通视频播放策略
        advanceFullScreenVideo.setGdtVideoOption(new VideoOption.Builder().setAutoPlayMuted(false)
                .setAutoPlayPolicy(VideoOption.AutoPlayPolicy.NEVER)
                .build());
        //可选： 设置广点通媒体状态监听
        advanceFullScreenVideo.setGdtMediaListener(new UnifiedInterstitialMediaListener() {
            @Override
            public void onVideoInit() {
                Log.d(TAG, "onVideoInit");

            }

            @Override
            public void onVideoLoading() {
                Log.d(TAG, "onVideoLoading");

            }

            @Override
            public void onVideoReady(long l) {
                Log.d(TAG, "onVideoReady ,video duration = " + l);

            }

            @Override
            public void onVideoStart() {
                Log.d(TAG, "onVideoStart");

            }

            @Override
            public void onVideoPause() {
                Log.d(TAG, "onVideoPause");

            }

            @Override
            public void onVideoComplete() {
                Log.d(TAG, "MediaListener onVideoComplete");

            }

            @Override
            public void onVideoError(AdError adError) {
                Log.d(TAG, "onVideoError code:" + adError.getErrorCode() + " msg:" + adError.getErrorMsg());

            }

            @Override
            public void onVideoPageOpen() {
                Log.d(TAG, "onVideoPageOpen");

            }

            @Override
            public void onVideoPageClose() {
                Log.d(TAG, "onVideoPageClose");

            }
        });
    }

    public void loadFull(View view) {
        isReady = false;
        advanceFullScreenVideo.loadAd();
    }

    public void showFull(View view) {
        if (isReady && advanceFullScreenItem != null) {
            if (AdvanceConfig.SDK_ID_CSJ.equals(advanceFullScreenItem.getSdkId())) {
                CsjFullScreenVideoItem csj = (CsjFullScreenVideoItem) advanceFullScreenItem;
                csj.setDownloadListener(new TTAppDownloadListener() {
                    @Override
                    public void onIdle() {
                        Log.d(TAG, "onIdle");

                    }

                    @Override
                    public void onDownloadActive(long l, long l1, String s, String s1) {
                        Log.d(TAG, "onDownloadActive");

                    }

                    @Override
                    public void onDownloadPaused(long l, long l1, String s, String s1) {
                        Log.d(TAG, "onDownloadPaused");

                    }

                    @Override
                    public void onDownloadFailed(long l, long l1, String s, String s1) {
                        Log.d(TAG, "onDownloadFailed");

                    }

                    @Override
                    public void onDownloadFinished(long l, String s, String s1) {
                        Log.d(TAG, "onDownloadFinished");

                    }

                    @Override
                    public void onInstalled(String s, String s1) {
                        Log.d(TAG, "onInstalled");

                    }
                });
            }
            advanceFullScreenItem.showAd();
        }
    }

    @Override
    public void onAdLoaded(AdvanceFullScreenItem advanceFullScreenItem) {
        Log.d(TAG, "onAdLoaded");

        //广点通 onVideoCached 方法在show以后才会触发，所以在获取广告后就可以去做展示
        if (AdvanceConfig.SDK_ID_GDT.equals(advanceFullScreenItem.getSdkId())) isReady = true;
        this.advanceFullScreenItem = advanceFullScreenItem;
        Toast.makeText(this, "广告加载成功", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdClose() {
        Log.d(TAG, "onAdClose");
        Toast.makeText(this, "广告关闭", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onVideoComplete() {
        Log.d(TAG, "onVideoComplete");
        Toast.makeText(this, "视频播放结束", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onVideoSkipped() {
        Log.d(TAG, "onVideoSkipped");
        Toast.makeText(this, "跳过视频", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onVideoCached() {
        //穿山甲可以广告缓存成功后再去展示广告
        isReady = true;

        Log.d(TAG, "onVideoCached");
        Toast.makeText(this, "广告缓存成功", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdShow() {
        Log.d(TAG, "onAdShow");
        Toast.makeText(this, "广告展示", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdFailed() {
        Log.d(TAG, "onAdFailed");
        Toast.makeText(this, "广告加载失败", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdClicked() {
        Log.d(TAG, "onAdClicked");
        Toast.makeText(this, "广告点击", Toast.LENGTH_SHORT).show();

    }
}
```




## 7.自定义广告

非自定义的各个广告位是由我们Advance SDK来默认实现了通用的需求，且广告位和SDK渠道位比较固定，比较适合希望快速实现的客户；自定义广告位是广告的具体实现和展示由客户端来决定，这样可以满足客户端的多样性需求，而Advance SDK主要来负责策略（使用哪个SDK加载广告的策略）的下发和数据统计上报，客户端需要适配开发，比较适合希望实现自渲染广告等多样性格式广告或者需要除广点通、穿山甲、mercury这三个SDK渠道以外的需求。

目前自定义广告可以实现SDK渠道和广告位的自定义，如果需要新增渠道或者广告位可以联系我们，目前暂未开发客户自己添加的权限。

### 7.1 banner自定义示例


#### 自定义banner广告位初始化

MyBannerAd代表自定义的banner广告位，在selectSdkSupplier方法中处理SDK的策略方案，suppliers是包含了打底和服务器返回的广告策略组合，suppliers.get(0)为优先级最高的策略；然后通过sdktag确定初始化哪个广告位，init***Banner() 方法代表了SDK渠道的初始化和loadAd。具体可以参照下面代码中的示例去初自定义广告。

```
public class MyBannerAd extends AdvanceBaseAdspot {
    private ViewGroup adContainer;
    private AdvanceBannerListener listener;//这里也可以根据自己需求自定义，这里使用了默认的 AdvanceBannerListener。

    @Deprecated
    public MyBannerAd(Activity activity, ViewGroup adContainer, String mediaId, String adspotId) {
        super(activity, mediaId, adspotId);
        this.adContainer = adContainer;
    }

    public MyBannerAd(Activity activity, ViewGroup adContainer, String adspotId) {
        super(activity, "", adspotId);
        this.adContainer = adContainer;
    }

    public void setAdListener(AdvanceBannerListener listener) {
        this.listener = listener;
    }


    public void selectSdkSupplier() {
        try {
            if (suppliers == null || suppliers.isEmpty()) {
                LogUtil.AdvanceLog("No SDK");
                if (null != listener) {
                    listener.onAdFailed();
                }
            } else {
                currentSdkSupplier = suppliers.get(0);
                LogUtil.AdvanceLog("select sdk:" + currentSdkSupplier.id);
                suppliers.remove(0);
                //策略成功下发上报
                reportAdvanceLoaded();
                //根据策略选中的sdk标志，初始化各个SDK广告位
                if (AdvanceConfig.SDK_ID_MERCURY.equals(currentSdkSupplier.id)) {
                    initMercuryBanner();

                } else if (AdvanceConfig.SDK_ID_GDT.equals(currentSdkSupplier.id)) {
                    initGdtBanner();

                } else if (AdvanceConfig.SDK_ID_CSJ.equals(currentSdkSupplier.id)) {
                    initCsjBanner();
                } else if ("其他渠道id".equals(currentSdkSupplier.id)) {
                    //进行其他渠道广告位的初始化创建、比如百度SDK，inmobi等等
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
            if (null != listener) {
                listener.onAdFailed();
            }
        }
    }

    @Override
    public void selectSdkSupplierFailed() {
        if (listener != null) {
            listener.onAdFailed();
        }

    }

    /**
     * 初始化时可以选择使用自己封装adapter，也可以选用聚合内已实现的adapter
     **/
    private void initMercuryBanner() {
        try {
            //建议使用自定义的adapter，那么需要新建一个MyMercuryBannerAdapter 去做广告的一些适配及加载等操作
            MyMercuryBannerAdapter mercuryBannerAdapter = new MyMercuryBannerAdapter(activity, adContainer, this, currentSdkSupplier);

//       如果不想自定义adapter，可以使用聚合内已实现的adapter，需要设置 Banner 的一些必须属性和回调，在相应回调事件中进行事件上报和部分自定义值设定
//            MercuryBannerAdapter mercuryBannerAdapter = new MercuryBannerAdapter(activity, adContainer, getBannerSetting() , currentSdkSupplier);
            mercuryBannerAdapter.loadAd();
        } catch (Throwable e) {
            e.printStackTrace();
            onFailed();
        }


    }

    /**
     * 初始化时可以选择使用自己封装adapter，也可以选用聚合内已实现的adapter
     **/
    private void initGdtBanner() {
        try {
            //建议使用自定义的adapter
            MyGdtBannerAdapter gdtBannerAdapter = new MyGdtBannerAdapter(activity, adContainer, this, currentSdkSupplier);
//            如果不想自定义adapter，可以使用聚合内已实现的adapter，需要设置 Banner 的一些必须属性和回调，在相应回调事件中进行事件上报和部分自定义值设定
//            GdtBannerAdapter gdtBannerAdapter = new GdtBannerAdapter(activity, adContainer, getBannerSetting() , currentSdkSupplier);
            gdtBannerAdapter.loadAd();
        } catch (Throwable e) {
            e.printStackTrace();
            onFailed();
        }
    }

    /**
     * 初始化时可以选择使用自己封装adapter，也可以选用聚合内已实现的adapter
     **/

    private void initCsjBanner() {
        try {
            //使用自定义的adapter
            MyCsjBannerAdapter csjBannerAdapter = new MyCsjBannerAdapter(activity, adContainer, this, currentSdkSupplier);
//            如果不想自定义adapter，可以使用聚合内已实现的adapter，需要设置 Banner 的一些必须属性和回调，在相应回调事件中进行事件上报和部分自定义值设定
//            CsjBannerAdapter csjBannerAdapter = new CsjBannerAdapter(activity, adContainer, getBannerSetting() , currentSdkSupplier);
            csjBannerAdapter.loadAd();
        } catch (Throwable e) {
            e.printStackTrace();
            onFailed();
        }
    }

    /**
     * ！！！如果自己去自定义adapter，这里完全可以删除
     * 不想自定义adapter的时候需要，需要在这里先设置banner的属性和回调处理
     *
     * @return 聚合SDK封装好的adapter需要的BannerSetting设置项
     */
    private BannerSetting getBannerSetting() {
        return new BannerSetting() {
            @Override
            public void adapterDidDislike() { // csj回调了dislike逻辑
                doDislike();
            }

            //设置广点通、穿山甲 banner 刷新间隔时长
            @Override
            public int getRefreshInterval() {
                return 30;
            }

            //穿山甲部分设置：这个参数设置即可，不影响个性化模板广告的size，单位Px
            @Override
            public int getCsjAcceptedSizeWidth() {
                return 640;
            }

            //穿山甲部分设置：这个参数设置即可，不影响个性化模板广告的size，单位Px
            @Override
            public int getCsjAcceptedSizeHeight() {
                return 100;
            }

            //穿山甲部分设置必选参数 设置穿山甲期望个性化模板广告view的size,单位dp
            @Override
            public int getCsjExpressViewAcceptedWidth() {
                return 640;
            }

            //穿山甲部分设置必选参数 设置穿山甲期望个性化模板广告view的size,单位dp
            @Override
            public int getCsjExpressViewAcceptedHeight() {
                return 100;
            }

            //统一回调： 广告下发成功
            @Override
            public void adapterDidSucceed() {
                onLoaded();
            }

            //统一回调： 广告展示成功
            @Override
            public void adapterDidShow() {
                onShow();
            }

            //统一回调： 广告加载失败
            @Override
            public void adapterDidClicked() {
                onClicked();
            }

            //统一回调： 广告被点击
            @Override
            public void adapterDidFailed() {
                onFailed();
            }
        };
    }


    // ---------- !!! 这里开始到最后 是设置自定义的 My***Adapter 中部分统一的事件回调和事件上报操作


    public void doDislike() {
        if (null != listener) {
            listener.onDislike();
        }
    }


    //广告下发成功，需要调用report方法进行成功上报，否则聚合系统无发统计到广告信息
    public void onLoaded() {
        reportAdLoaded();
    }

    //广告展示成功，需要调用report方法进行成功上报，否则聚合系统无发统计到广告信息
    public void onShow() {
        reportAdShow();
        if (null != listener) {
            listener.onAdShow();
        }
    }

    //广告加载失败，需要调用report方法进行上报，否则聚合系统无发统计到广告信息
    public void onFailed() {
        reportAdFailed();
        //失败后重新去选择SDK策略,先不回调失败
        selectSdkSupplier();
    }

    //广告点击，需要调用report方法进行上报，否则聚合系统无发统计到广告信息
    public void onClicked() {
        reportAdClicked();
        if (null != listener) {
            listener.onAdClicked();
        }
    }
    // ---------- !!! 统一的事件回调和事件上报操作结束

}

```

#### 自定义banner的渠道和广告位设置

MyGdtBannerAdapter代表自定义的广点通渠道下的banner广告为信息设置。如果不想自定义adapter可以使用默认的GdtBannerAdapter，具体可以参考MyBannerAd中BannerSetting相关内容和说明。

这里要在广告收到、展示、点击、失败的事件里调用MyNativeCustomizeAd 里的统一事件来进行事件上报和回调等统一性操作。

```
public class MyGdtBannerAdapter {
    private Activity activity;
    private SdkSupplier sdkSupplier;
    private MyBannerAd advanceBanner;
    private ViewGroup adContainer;
    private UnifiedBannerView bv;
    private int refreshInterval = 30;

    public MyGdtBannerAdapter(Activity activity, ViewGroup adContainer, final MyBannerAd advanceBanner, SdkSupplier sdkSupplier) {
        this.activity = activity;
        this.advanceBanner = advanceBanner;
        this.sdkSupplier = sdkSupplier;
        this.adContainer = adContainer;
    }

    public void loadAd() {
        try {

            bv = new UnifiedBannerView(activity, AdvanceUtil.getGdtAccount(sdkSupplier.mediaid), sdkSupplier.adspotid, new UnifiedBannerADListener() {
                @Override
                public void onNoAD(AdError adError) {
                    LogUtil.AdvanceLog(adError.getErrorCode() + adError.getErrorMsg());
                    if (null != advanceBanner) {
                        advanceBanner.onFailed();
                    }
                }

                @Override
                public void onADReceive() {
                    if (null != advanceBanner) {
                        advanceBanner.onLoaded();
                    }

                }

                @Override
                public void onADExposure() {
                    if (null != advanceBanner) {
                        advanceBanner.onShow();
                    }

                }

                @Override
                public void onADClosed() {

                }

                @Override
                public void onADClicked() {
                    if (null != advanceBanner) {
                        advanceBanner.onClicked();
                    }

                }

                @Override
                public void onADLeftApplication() {

                }

                @Override
                public void onADOpenOverlay() {

                }

                @Override
                public void onADCloseOverlay() {

                }
            });
            bv.setRefresh(refreshInterval);
            adContainer.removeAllViews();
            adContainer.addView(bv, new RelativeLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT));
            /* 发起广告请求，收到广告数据后会展示数据   */
            bv.loadAD();
        } catch (Exception e) {
            e.printStackTrace();
            if (advanceBanner != null)
                advanceBanner.onFailed();
        }
    }

    public void destroy() {
        if (null != bv) {
            bv.destroy();
        }
    }
}
```
#### 调用和展示自定义banner

调用方式和普通的sdk广告调用方式一样，注意一定要设置打底广告。

```
public class BannerCustomizeActivity extends Activity implements AdvanceBannerListener {
    private String TAG = "BannerCustomizeActivity";

    MyBannerAd myBannerAd;
    FrameLayout adContainer;

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_banner_cus);
        adContainer = findViewById(R.id.fl_ad);
        myBannerAd = new MyBannerAd(this, adContainer,  ADManager.getInstance().getBannerAdspotId());
        //推荐：核心事件监听回调
        myBannerAd.setAdListener(this);
        //推荐：设置是否将获取到的SDK选择策略进行缓存
        myBannerAd.enableStrategyCache(false);
        //必须：设置打底SDK参数
        myBannerAd.setDefaultSdkSupplier(new SdkSupplier( "10000396" , AdvanceSupplierID.MERCURY));
        //注意：如果是使用自定义渠道的广告做打底，需要额外设置媒体id参数！！
//        myBannerAd.setDefaultSdkSupplier(new SdkSupplier( "自定义sdk渠道媒体id","自定义sdk渠道广告位id" , "自定义sdk渠道id"));
        myBannerAd.loadAd();
    }

    @Override
    public void onAdShow() {
        Log.d(TAG, "SHOW");
        Toast.makeText(this, "广告展现", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdFailed() {

        Log.d(TAG, "Failed");
        Toast.makeText(this, "广告失败", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onAdClicked() {
        Log.d(TAG, "Clicked");
        Toast.makeText(this, "广告点击", Toast.LENGTH_SHORT).show();

    }

    @Override
    public void onDislike() {
        Toast.makeText(this, "广告关闭", Toast.LENGTH_SHORT).show();
        adContainer.removeAllViews();

    }

}
```
### 7.2 自渲染广告自定义示例

#### 自渲染广告初始化

和Banner示例类似，MyNativeCustomizeAd代表自定义的自渲染广告位，需要继承AdvanceBaseAdspot，在selectSdkSupplier方法中处理SDK的策略方案，suppliers是包含了打底和服务器返回的广告策略组合，suppliers.get(0)为优先级最高的策略；然后通过sdktag确定初始化哪个广告位，init***GdtNat() 方法代表了SDK渠道的初始化和loadAd。具体可以参照下面代码中的示例去自定义广告位。

```
public class MyNativeCustomizeAd extends AdvanceBaseAdspot {

    private FrameLayout adContainer;
    @Deprecated
    public MyNativeCustomizeAd(Activity activity, String mediaId, String adspotId) {
        super(activity, mediaId, adspotId);
    }

    public MyNativeCustomizeAd(Activity activity,  String adspotId) {
        super(activity, "", adspotId);
    }
    private MyNativeCustomizeListener listener;

    public void setListener(MyNativeCustomizeListener listener) {
        this.listener = listener;
    }

    public FrameLayout getAdContainer() {
        return adContainer;
    }

    public void setAdContainer(FrameLayout adContainer) {
        this.adContainer = adContainer;
    }

    @Override
    public void selectSdkSupplier() {
        try {
            if (suppliers == null || suppliers.isEmpty()) {
                LogUtil.AdvanceLog("No SDK");
                if (null != listener) {
                    listener.onAdFailed();
                }
            } else {
                currentSdkSupplier = suppliers.get(0);
                LogUtil.AdvanceLog("select sdk:" + currentSdkSupplier.id);
                suppliers.remove(0);
                //策略成功下发上报
                reportAdvanceLoaded();
                //根据策略选中的sdk标志，初始化各个SDK广告位
                if (AdvanceConfig.SDK_ID_MERCURY.equals(currentSdkSupplier.id)) {
                    initMercuryNat();
                } else if (AdvanceConfig.SDK_ID_GDT.equals(currentSdkSupplier.id)) {
                    initGdtNat();
                } else if (AdvanceConfig.SDK_ID_CSJ.equals(currentSdkSupplier.id)) {
                    initCsjNat();
                } else if ("4".equals(currentSdkSupplier.id)) { //百度渠道
                    //进行其他渠道广告位的初始化创建、比如百度SDK，inmobi等等
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
            if (null != listener) {
                listener.onAdFailed();
            }
        }
    }

    @Override
    public void selectSdkSupplierFailed() {
        if (listener != null) {
            listener.onAdFailed();
        }
    }

    private void initMercuryNat() {
        try {
            MyMercuryNCAdapter adapter = new MyMercuryNCAdapter(activity, this, currentSdkSupplier);
            adapter.loadAd();
        } catch (Exception e) {
            e.printStackTrace();
            //广告初始化失败
            onFailed();
        }
    }

    private void initGdtNat() {
        try {
            MyGdtNCAdapter adapter = new MyGdtNCAdapter(activity, this, currentSdkSupplier);
            adapter.loadAd();
        } catch (Exception e) {
            e.printStackTrace();
            //广告初始化失败
            onFailed();
        }
    }

    private void initCsjNat() {
        try {
            MyCsjNCAdapter adapter = new MyCsjNCAdapter(activity, this, currentSdkSupplier);
            adapter.loadAd();
        } catch (Exception e) {
            e.printStackTrace();
            //广告初始化失败
            onFailed();
        }
    }


    // ---------- !!! 这里开始到最后 是设置自定义的 My***Adapter 中部分统一的事件回调和事件上报操作


    //广告下发成功，需要调用report方法进行成功上报，否则聚合系统无发统计到广告信息
    public void onLoaded(List<MyNativeCustomizeAdItem> list) {
        reportAdLoaded();
        if (null != listener) {
            listener.onAdLoaded(list);
        }
    }

    //广告展示成功，需要调用report方法进行成功上报，否则聚合系统无发统计到广告信息
    public void onShow(MyNativeCustomizeAdItem item) {
        reportAdShow();
        if (null != listener) {
            listener.onAdShow(item);
        }
    }

    //广告加载失败，需要调用report方法进行上报，否则聚合系统无发统计到广告信息
    public void onFailed() {
        reportAdFailed();
        //失败后重新去选择SDK策略,先不回调失败
        selectSdkSupplier();
    }

    //广告点击，需要调用report方法进行上报，否则聚合系统无发统计到广告信息
    public void onClicked(MyNativeCustomizeAdItem item) {
        reportAdClicked();
        if (null != listener) {
            listener.onAdClicked(item);
        }
    }

    //广告关闭
    public void onClosed(MyNativeCustomizeAdItem item) {
        if (null != listener) {
            listener.onAdClose(item);
        }
    }


    // ---------- !!! 统一的事件回调和事件上报操作结束

}
```

#### 自渲染广告的渠道和广告位设置

MyGdtNCAdapter实现广点通广告的拉取，GdtNativeAdData完成布局和广告属性自定义。这里要在广告收到、展示、点击、失败的事件里调用MyNativeCustomizeAd 里的统一事件来进行事件上报和回调等统一性操作。

```
public class MyGdtNCAdapter implements NativeADUnifiedListener {

    private Activity activity;
    private SdkSupplier sdkSupplier;
    private MyNativeCustomizeAd customizeAd;
    private NativeUnifiedAD mAdManager;

    public MyGdtNCAdapter(Activity activity, MyNativeCustomizeAd customizeAd, SdkSupplier sdkSupplier) {
        this.activity = activity;
        this.customizeAd = customizeAd;
        this.sdkSupplier = sdkSupplier;

    }

    public void loadAd() {
        try {
            mAdManager = new NativeUnifiedAD(activity, AdvanceUtil.getGdtAccount(sdkSupplier.mediaid), sdkSupplier.adspotid, this);
            mAdManager.setMaxVideoDuration(60);
            mAdManager.setDownAPPConfirmPolicy(DownAPPConfirmPolicy.NOConfirm);
            mAdManager.loadData(sdkSupplier.adCount);
        } catch (Exception e) {
            e.printStackTrace();
            customizeAd.onFailed();
        }

    }

    @Override
    public void onADLoaded(List<NativeUnifiedADData> list) {
        if (list == null || list.isEmpty()) {
            customizeAd.onFailed();
        } else {
            ArrayList<MyNativeCustomizeAdItem> advanceNativeAdDataList = new ArrayList<>();
            for (NativeUnifiedADData nativeUnifiedADData : list) {
                GdtNativeAdData advanceNativeAdData = new GdtNativeAdData(activity, nativeUnifiedADData, customizeAd);
                advanceNativeAdDataList.add(advanceNativeAdData);
            }
            customizeAd.onLoaded(advanceNativeAdDataList);
        }
    }

    @Override
    public void onNoAD(AdError adError) {
        LogUtil.AdvanceLog(adError.getErrorCode() + adError.getErrorMsg());
        customizeAd.onFailed();
    }


    private class GdtNativeAdData implements MyNativeCustomizeAdItem {

        private View adView;
        NativeUnifiedADData nativeUnifiedADData;
        Activity activity;
        MyNativeCustomizeAd myNativeCustomizeAd;

        ImageView mIcon;
        ImageView mDislike;
        Button mCreativeButton;
        TextView mTitle;
        TextView mDescription;
        TextView mSource;

        ImageView mGroupImage1;
        ImageView mGroupImage2;
        ImageView mGroupImage3;
        LinearLayout mGroupContainer;

        private MediaView mMediaView;
        private ImageView mImagePoster;
        private NativeAdContainer nativeContainer;

        String TAG = "GdtNativeAdData";

        public GdtNativeAdData(Activity activity, NativeUnifiedADData nativeUnifiedADData, MyNativeCustomizeAd myNativeCustomizeAd) {
            this.activity = activity;
            this.nativeUnifiedADData = nativeUnifiedADData;
            this.myNativeCustomizeAd = myNativeCustomizeAd;

            try {
                adView = LayoutInflater.from(activity).inflate(R.layout.gdt_nc_layout, null, false);
                initViews();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }

        private void initViews() {
            mIcon = adView.findViewById(R.id.iv_nc_icon);
            mDislike = adView.findViewById(R.id.iv_nc_dislike);
            mCreativeButton = adView.findViewById(R.id.btn_nc_creative);
            mTitle = adView.findViewById(R.id.tv_nc_ad_title);
            mDescription = adView.findViewById(R.id.tv_nc_ad_desc);
            mSource = adView.findViewById(R.id.tv_nc_ad_source);

            mGroupContainer = adView.findViewById(R.id.native_3img);
            mGroupImage1 = adView.findViewById(R.id.img_1);
            mGroupImage2 = adView.findViewById(R.id.img_2);
            mGroupImage3 = adView.findViewById(R.id.img_3);

            mMediaView = adView.findViewById(R.id.gdt_media_view);
            mImagePoster = adView.findViewById(R.id.img_poster);
            nativeContainer = adView.findViewById(R.id.native_ad_container);
        }

        @Override
        public void showAd() {
            try {
                FrameLayout adContainer = myNativeCustomizeAd.getAdContainer();
                if (adContainer == null) {
                    Log.e("GdtNativeAdData", "需要先调用setAdContainer 设置广告位载体");
                    return;
                }
                adContainer.removeAllViews();

                renderAdUi(nativeUnifiedADData);
                updateAdAction(nativeUnifiedADData);

                List<View> clickableViews = new ArrayList<>();
                // 所有广告类型，注册点击事件
                clickableViews.add(mCreativeButton);

                if (nativeUnifiedADData.getAdPatternType() == AdPatternType.NATIVE_VIDEO) {

                    nativeUnifiedADData.bindAdToView(activity, nativeContainer, null, clickableViews);

                    VideoOption videoOption = getVideoOption();
                    nativeUnifiedADData.bindMediaView(mMediaView, videoOption, new NativeADMediaListener() {
                        @Override
                        public void onVideoInit() {
                            Log.d(TAG, "onVideoInit: ");
                        }

                        @Override
                        public void onVideoLoading() {
                            Log.d(TAG, "onVideoLoading: ");
                        }

                        @Override
                        public void onVideoReady() {
                            Log.d(TAG, "onVideoReady");
                        }

                        @Override
                        public void onVideoLoaded(int videoDuration) {
                            Log.d(TAG, "onVideoLoaded: ");
                        }

                        @Override
                        public void onVideoStart() {
                            Log.d(TAG, "onVideoStart");
                        }

                        @Override
                        public void onVideoPause() {
                            Log.d(TAG, "onVideoPause: ");
                        }

                        @Override
                        public void onVideoResume() {
                            Log.d(TAG, "onVideoResume: ");
                        }

                        @Override
                        public void onVideoCompleted() {
                            Log.d(TAG, "onVideoCompleted: ");
                        }

                        @Override
                        public void onVideoError(AdError error) {
                            Log.d(TAG, "onVideoError: ");
                        }

                        @Override
                        public void onVideoStop() {
                            Log.d(TAG, "onVideoStop");
                        }

                        @Override
                        public void onVideoClicked() {
                            Log.d(TAG, "onVideoClicked");
                        }
                    });
                } else if (nativeUnifiedADData.getAdPatternType() == AdPatternType.NATIVE_2IMAGE_2TEXT ||
                        nativeUnifiedADData.getAdPatternType() == AdPatternType.NATIVE_1IMAGE_2TEXT) {
                    // 双图双文、单图双文：注册mImagePoster的点击事件
                    clickableViews.add(mImagePoster);
                    nativeUnifiedADData.bindAdToView(activity, nativeContainer, null, clickableViews);
                } else {
                    // 三小图广告：注册native_3img_ad_container的点击事件
                    clickableViews.add(mGroupContainer);
                    nativeUnifiedADData.bindAdToView(activity, nativeContainer, null, clickableViews);
                }
                nativeUnifiedADData.setNativeAdEventListener(new NativeADEventListener() {
                    @Override
                    public void onADExposed() {
                        Log.d(TAG, "onADExposed: ");
                        if (customizeAd != null)
                            customizeAd.onShow(GdtNativeAdData.this);
                    }

                    @Override
                    public void onADClicked() {
                        Log.d(TAG, "onADClicked: " + " clickUrl: " + nativeUnifiedADData.ext.get("clickUrl"));
                        if (customizeAd != null)
                            customizeAd.onClicked(GdtNativeAdData.this);

                    }

                    @Override
                    public void onADError(AdError error) {
                        Log.d(TAG, "onADError error code :" + error.getErrorCode() + "  error msg: " + error.getErrorMsg());
                        if (customizeAd != null)
                            customizeAd.onFailed();
                    }

                    @Override
                    public void onADStatusChanged() {
                        Log.d(TAG, "onADStatusChanged: ");
                        updateAdAction(nativeUnifiedADData);
                    }
                });
                adContainer.addView(adView);
            } catch (Exception e) {
                e.printStackTrace();
                if (customizeAd != null)
                    customizeAd.onFailed();
            }

        }

        @Override
        public String getSupplierId() {
            return AdvanceConfig.SDK_ID_GDT;
        }

        private VideoOption getVideoOption() {
            VideoOption videoOption;
            VideoOption.Builder builder = new VideoOption.Builder();

            builder.setAutoPlayPolicy(VideoOption.AutoPlayPolicy.ALWAYS);
            builder.setAutoPlayMuted(true);
            builder.setDetailPageMuted(false);
            builder.setNeedCoverImage(true);
            builder.setNeedProgressBar(true);
            builder.setEnableDetailPage(true);
            builder.setEnableUserControl(false);
            videoOption = builder.build();
            return videoOption;
        }


        private void renderAdUi(final NativeUnifiedADData ad) {
            //广点通不包含source字段
            mSource.setVisibility(View.GONE);

            mTitle.setText(ad.getTitle());
            mDescription.setText(ad.getDesc());

            int patternType = ad.getAdPatternType();
            if (patternType == AdPatternType.NATIVE_2IMAGE_2TEXT || patternType == AdPatternType.NATIVE_1IMAGE_2TEXT) {
                if (patternType == AdPatternType.NATIVE_2IMAGE_2TEXT) {
                    Glide.with(activity).load(ad.getIconUrl()).into(mIcon);
                }
                Glide.with(activity).load(ad.getImgUrl()).into(mImagePoster);
                mImagePoster.setVisibility(View.VISIBLE);
                mGroupContainer.setVisibility(View.GONE);
                mMediaView.setVisibility(View.GONE);
            } else if (patternType == AdPatternType.NATIVE_VIDEO) {
                Glide.with(activity).load(ad.getIconUrl()).into(mIcon);

                mImagePoster.setVisibility(View.GONE);
                mGroupContainer.setVisibility(View.GONE);
                mMediaView.setVisibility(View.VISIBLE);
            } else if (patternType == AdPatternType.NATIVE_3IMAGE) {
                Glide.with(activity).load(ad.getIconUrl()).into(mIcon);

                Glide.with(activity).load(ad.getImgList().get(0)).into(mGroupImage1);
                Glide.with(activity).load(ad.getImgList().get(1)).into(mGroupImage2);
                Glide.with(activity).load(ad.getImgList().get(2)).into(mGroupImage3);
                mGroupContainer.setVisibility(View.VISIBLE);
                mMediaView.setVisibility(View.GONE);
                mImagePoster.setVisibility(View.GONE);
            }
            mDislike.setOnClickListener(new View.OnClickListener() {
                @Override
                public void onClick(View v) {
                    ad.destroy();
                    nativeContainer.removeAllViews();
                    if (customizeAd != null)
                        customizeAd.onClosed(GdtNativeAdData.this);
                }
            });
        }

        void updateAdAction(NativeUnifiedADData ad) {
            if (!ad.isAppAd()) {
                mCreativeButton.setText("浏览");
                return;
            }
            switch (ad.getAppStatus()) {
                case 0:
                    mCreativeButton.setText("下载");
                    break;
                case 1:
                    mCreativeButton.setText("启动");
                    break;
                case 2:
                    mCreativeButton.setText("更新");
                    break;
                case 4:
                    mCreativeButton.setText(ad.getProgress() + "%");
                    break;
                case 8:
                    mCreativeButton.setText("安装");
                    break;
                case 16:
                    mCreativeButton.setText("下载失败，重新下载");
                    break;
                default:
                    mCreativeButton.setText("浏览");
                    break;
            }
        }
    }

}

```

#### 调用和展示自定义的自渲染广告

和普通的广告位调用方式一样。

```
public class NativeCustomizeActivity extends Activity implements MyNativeCustomizeListener {

    MyNativeCustomizeAd nativeCustomizeAd;
    FrameLayout fl;
    String Tag = NativeCustomizeActivity.class.getSimpleName();

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_ad_container);
        fl = findViewById(R.id.fl_ad);

        //创建自己的自渲染广告位
        nativeCustomizeAd = new MyNativeCustomizeAd(this, "后台获取的广告位id");
        //必须：设置广告载体
        nativeCustomizeAd.setAdContainer(fl);
        //推荐：设置是否开启策略缓存模式
        nativeCustomizeAd.enableStrategyCache(true);
//       推荐： 添加自定义的核心事件回调listener
        nativeCustomizeAd.setListener(this);
//        必须：设置打底广告，无策略时，会先走这里设置的打底广告。下面是各个渠道的测试用打底广告。
        nativeCustomizeAd.setDefaultSdkSupplier(new SdkSupplier("4090398440079274", AdvanceSupplierID.GDT));
//        nativeCustomizeAd.setDefaultSdkSupplier(new SdkSupplier("10002805", AdvanceSupplierID.MERCURY);
//        nativeCustomizeAd.setDefaultSdkSupplier(new SdkSupplier( "10002806",  AdvanceSupplierID.MERCURY));
//        nativeCustomizeAd.setDefaultSdkSupplier(new SdkSupplier( "901121737",  AdvanceSupplierID.CSJ));
//        注意：如果是使用自定义渠道的广告做打底，需要额外设置媒体id参数！！
//        myBannerAd.setDefaultSdkSupplier(new SdkSupplier( "自定义sdk渠道媒体id","自定义sdk渠道广告位id" , "自定义sdk渠道id"));
//        请求广告
        nativeCustomizeAd.loadAd();
    }


    @Override
    public void onAdClose(MyNativeCustomizeAdItem item) {
        Log.d(Tag, "onAdClose" + item.getSupplierId());
        fl.removeAllViews();
    }

    @Override
    public void onAdShow(MyNativeCustomizeAdItem item) {
        Log.d(Tag, "onAdShow" + item.getSupplierId());
    }

    @Override
    public void onAdFailed() {
        Log.d(Tag, "onAdFailed");

    }

    @Override
    public void onAdClicked(MyNativeCustomizeAdItem item) {
        Log.d(Tag, "onAdClicked" + item.getSupplierId());

    }

    @Override
    public void onAdLoaded(List<MyNativeCustomizeAdItem> list) {
        Log.d(Tag, "onAdLoaded" + list);

        //获取到广告调用封装的showAd方法来展示广告
        if (list != null && list.size() > 0) {
            list.get(0).showAd();
        }
    }
}
```

### 7.3 自定义广告注意事项

1.确保广告各个展示周期（加载、展示、点击、失败）的事件上报正常，调用方法分别是 reportAdLoaded()，reportAdShow()， reportAdClicked()，reportAdFailed()。

2.如果不想自己去实现各个渠道adapter，那么可以使用默认adapter实现，对应命名为 `渠道缩写`+`广告位命名`+`Adapter`；比如CsjBannerAdapter。在初始化默认adapter时需要定义对应的`广告位命名`+`Setting` 接口，比如BannerSetting；具体可以参考6.1中自定义banner中的实现。

3.设置打底广告的时候注意调用的渠道，如果是使用除mercury、广点通、穿山甲以外的渠道，要定义渠道的媒体id和渠道id（如果不清楚渠道id可以询问我们）参数，否则无法正确加载打底广告。设置现有渠道的广告位为打底时要保证SDK初始化时设置的媒体id和打底的广告位id匹配，否则会无法加载广告。


