# Advance 聚合SDK对接文档-Android

<font size = "4">**版本号：v3.4.3**


## 1.集成须知

1. Advance 聚合SDK示例Demo	:
[点击下载最新Demo](http://www.bayescom.com/download/sdk.php?sdk=advance_android)

2. Advance 聚合SDK工作流程图示
![](advMapHigh.png)
3. 广告SDK广告位聚合支持情况

	| 平台\广告位| 	开屏 |  激励视频 | 横幅（banner） | 插屏 | 信息流 | 全屏视频 | 自定义广告
|:------------- |:---------------|  :---------------|  :---------------|  :---------------|  :---------------|  :---------------|   :---------------|  
| Mercury |支持 |支持 |支持 |支持 |支持 | | 支持
| 穿山甲|支持 |支持(模板)  |支持(模板)  |支持(模板)  |支持(模板)  |支持(模板)  |支持
| 广点通  |支持 |支持 |支持(2.0) |支持(2.0) |支持(1.0、2.0) |支持(2.0) |支持
| 快手 |支持 |支持 | | | 支持 | 支持|支持
| 百度 |支持  |支持  |支持 ||| |支持 

	<font size = "2"> **友情提示**：表格中不支持的渠道平台 or 广告位，可以通过下面 **7.自定义广告位** 来实现集成。

4. SDK渠道平台信息：

	| SDK平台: | 	Mercury | 广点通 |  穿山甲 | 百度|快手| AdvanceSDK
|:------------- |:---------------|  :---------------|  :---------------|  :---------------|  :---------------|  :---------------|  
|集成后apk安装包增加大小 :|0.3M |1.4M | 1.8M|0.6M |1.1M | 0.1M
|当前支持的版本号:| v3.3.3 |  v4.310.1180 | v3.4.0.0 |  内置v5.96| 内置v3.3.5.3| v3.4.2
|SDK ID 标识:| "1" |  "2"|  "3"|  "4"|  "5"| -

	**注意：** 请确保广点通和穿山甲的引入版本不低于当前支持的版本，否则可能出现广告加载异常。

5. 文档中各位置初始化的**聚合广告位id**为Advance后台流量管理所创建，打底设置的**打底广告位id**为具体的广告SDK流量平台（广点通、穿山甲、百度、快手等）所创建，**媒体id**设置与打底广告位id为绑定关系。

6. **策略最佳实践**说明
   
   本说明旨在引导各类APP进行正确的最优广告投放效果，实践差别主要看APP是否有品牌CPT包段订单，以下建议仅供参考，实际需要APP方根据自身情况进行选择。详细说明如下：
   
   一、 工具效果类APP最佳实践：
   
   工具效果类APP基本不存在CPT投放，建议进行如下设置：
   
   - **使用缓存策略模式**，建议策略缓存时间>7天，缓存可以大量缩短单次广告请求整体耗时，缓存下**请求策略**仅10ms左右，非缓存平均200ms左右
   
   - **设置打底渠道**，打底广告可以保证在策略服务异常时也能加载广告
   
   二、 视频娱乐类APP最佳实践：
   
   视频娱乐类APP可能会存在较多的CPT投放订单，建议进行如下设置：
   
   - **使用实时策略模式**，可根据运营情况，动态调整为缓存模式，建议缓存时间设置不超过3天。
   
   - **不建议设置打底渠道**，打底渠道设置的有可能是非CPT渠道，这样会影响CPT的包段效果，故不建议设置
   
   三、 小而美APP最佳实践：
   
   小而美APP可能会有少量 CPT投放订单，建议进行如下设置：
   
   - **使用实时策略模式**，可根据运营情况，动态调整为缓存模式，建议缓存时间设置不超过3天。
   
   - **设置打底渠道**，尽可能的不浪费展示机会。



## 2.SDK引入

SDK引入主要有两种方式，一是通过线上gradle依赖引入，二是通过本地aar包引入；聚合中两种引入方式均存在，以下为各个SDK的作用及引入方式，其中百度和快手为可选引入项：

- Advance SDK，聚合方案SDK，通过gradle引入（必须）：

 	```implementation 'com.advsdk:advance:x.x.x'```

- OAID SDK，MSA广告联盟SDK，详见 **3.OAID支持**，通过本地aar包引入（必须）:

	```implementation(name: 'oaid_sdk_x.x.x', ext: 'aar')```
	
- Mercury SDK，平台广告渠道包，通过通过gradle引入（必须）:
	
	```implementation 'com.mercury:mercurysdk:x.x.x'```
	
- 穿山甲SDK，头条穿山甲SDK广告渠道包，通过本地aar包引入（必须）:
	
	```implementation(name: 'open_ad_sdkxxxx', ext: 'aar')```


- 广点通SDK，腾讯优量汇SDK广告渠道包，通过gradle引入（必须）:
	
	```implementation 'com.qq.e.union:union:x.x.x'```

- 快手SDK，广告渠道包，通过gradle引入（可选）:

	```implementation 'com.advsdk:advance_ks:x.x.x'```
	
- 百青藤SDK，百度广告渠道包，通过gradle引入（可选）:

	```implementation 'com.advsdk:advance_bd:x.x.x'```
	


APP项目目录下build.gradle配置参考：


```groovy
repositories {
    flatDir {
        dirs 'libs'
    }
}

dependencies {
    
    //Advance聚合SDK 引入
    implementation 'com.advsdk:advance:3.4.2'

    //mercury SDK 引入
    implementation 'com.mercury:mercurysdk:3.3.3'
    //穿山甲SDK 引入
    implementation(name: 'open_ad_sdk3400', ext: 'aar')
    //广点通SDK 引入
    implementation 'com.qq.e.union:union:4.310.1180'
    //百度SDK 引入
    implementation 'com.advsdk:advance_bd:3.4.0_596'
    //快手SDK 引入
    implementation 'com.advsdk:advance_ks:3.4.0_3353'

    //MSA Android10以上设备唯一标识 OAID SDK 引入
    implementation(name: 'oaid_sdk_1.0.25', ext: 'aar')
}
```

为了适配穿山甲SDK下载和安装相关功能，在工程中引用的包 `com.android.support:support-v4:24.2.0 `
使用24.2.0以及以上版本。



## 3.OAID支持（Mercury SDK 需要）

Mercury SDK 在Android10 以上设备需要OAID才能正常下发广告。Mercury_3.3.0及以后版本 内置了 OAID 获取的功能（基于1.0.22版本）。为了正常获取必须：

1.添加最新版本 OAID 包（oaid_sdk_1.0.22.aar 或以上），最新包详见 [移动安全联盟 MSA 官网](https://msa-alliance.cn/col.jsp?id=120)。

2.在 assets 文件夹中添加文件 **supplierconfig.json**，这样才能正确获取到 OAID。

文件内容如下：（各个渠道有appid的话就填上去，没有的话保持内容不变即可）

```
{
  "supplier":{
    "vivo":{
      "appid":""
    },
    "xiaomi":{
    },
    "huawei":{
    },
    "oppo":{
    }
  }
}
```

3.如果 OAID 包低于**1.0.22**版本或者  Mercury SDK低于 **3.3.0**版本，建议升级aar包版本。如果**坚持使用旧版本**，请**自己获取**到 OAID 后调用 `MercuryAD.setOAID(String oaid)`方法对 OAID 赋值。

另外开发者可以在**SDK初始化成功**以后调用 `MercuryAD.getOAID()` 方法获取 OAID 检查正确性，如果结果不正确，观察`logcat` 下 `[OAIDHelper]`日志信息，一般是OAID aar资源包未引入或supplierconfig.json配置问题。


## 4.AndroidManifest.xml配置

1.为防止项目构建时抛 `Manifest merger failed`异常，需要在AndroidManifest.xml中加入以下适配代码，兼容SDK引用版本。

```
<!-- 如果未引入快手，com.advance.supplier.ks可以不添加-->
<uses-sdk tools:overrideLibrary="com.bun.miitmdid,com.advance.supplier.ks" />
```


2.要保证SDK能够正常工作需要申请必要的权限，如果targetSdkVersion>23还需要动态申请相关权限，具体实现可参见Demo工程 SplashActivity.java。

```Xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
<uses-permission android:name="android.permission.READ_PHONE_STATE" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />    <!-- 如果需要精确定位的话请加上此权限 -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />
<!--穿山甲相关-->
<uses-permission android:name="android.permission.GET_TASKS"/>
<!-- 如果有视频相关的广告且使用textureView播放，请务必添加，否则黑屏 -->
<uses-permission android:name="android.permission.WAKE_LOCK" />

```

3.如果您打包 App 时的 targetSdkVersion >= 28：在AndroidManifest.xml 添加依赖声明 `uses-library android:name="org.apache.http.legacy" android:required="false"`
在application标签中添加 `android:usesCleartextTraffic="true"`，否则 SDK 无法工作，示例如下：

```xml
<application
    android:name=".DemoApplication"
    android:icon="@drawable/gdticon"
    android:label="@string/app_name"
    android:theme="@style/AppTheme"
    android:usesCleartextTraffic="true">

    <uses-library
        android:name="org.apache.http.legacy"
        android:required="false" />
    ... ...
  </application>
```

4.注册SDK相关的Activity和Service:

```xml
<!--广点通-->
<service 
    android:name="com.qq.e.comm.DownloadService" 
    android:exported="false" />
<activity 
    android:name="com.qq.e.ads.ADActivity" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<activity 
    android:name="com.qq.e.ads.PortraitADActivity" 
    android:screenOrientation="portrait" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />
<activity 
    android:name="com.qq.e.ads.LandscapeADActivity" 
    android:screenOrientation="landscape" 
    android:configChanges="keyboard|keyboardHidden|orientation|screenSize"
    tools:replace="android:screenOrientation"  />


```

5.针对Andriod7.0以上文件访问兼容性配置，在AndroidManifest.xml中增加：

```xml
<!--穿山甲-->
<provider
    android:name="com.bytedance.sdk.openadsdk.TTFileProvider"
    android:authorities="${applicationId}.TTFileProvider"
    android:exported="false"
    android:grantUriPermissions="true">
   <meta-data
        android:name="android.support.FILE_PROVIDER_PATHS"
        android:resource="@xml/file_paths" />
</provider>
<provider
    android:name="com.bytedance.sdk.openadsdk.multipro.TTMultiProvider"
    android:authorities="${applicationId}.TTMultiProvider"
    android:exported="false" />
	
<!--广点通-->
        <provider
            android:name="com.qq.e.comm.GDTFileProvider"
            android:authorities="${applicationId}.gdt.fileprovider"
            android:exported="false"
            android:grantUriPermissions="true">
            <meta-data
                android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/gdt_file_path" />
        </provider>
```

在res/xml目录下，新建穿山甲xml文件file_paths.xml，在该文件中添加如下代码：

```xml
<?xml version="1.0" encoding="utf-8"?>
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <!--为了适配所有路径可以设置 path = "." -->
    <external-path name="tt_external_root" path="." />
    <external-path name="tt_external_download" path="Download" />
    <external-files-path name="tt_external_files_download" path="Download" />
    <files-path name="tt_internal_file_download" path="Download" />
    <cache-path name="tt_internal_cache_download" path="Download" />
</paths>
```

在res/xml目录下，新建广点通配置gdt_file_path.xml,在文件中添加如下代码:

```xml
<paths xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- 这个下载路径也不可以修改，必须为GDTDOWNLOAD -->
    <external-path
        name="gdt_sdk_download_path"
        path="GDTDOWNLOAD" />
    <external-files-path
        name="external_files_path"
        path="Download" />
    <external-path
        name="download"
        path="." />
    <external-cache-path
        name="gdt_sdk_download_path1"
        path="com_qq_e_download" />
    <cache-path
        name="gdt_sdk_download_path2"
        path="com_qq_e_download" />
</paths>
```

## 5.代码混淆配置

如果您需要使用proguard混淆代码，需确保不要混淆SDK的代码。 请在proguard.cfg文件(或其他混淆文件)尾部添加如下配置:

```
-keep class com.bytedance.sdk.openadsdk.** { *; }
-keep public interface com.bytedance.sdk.openadsdk.downloadnew.** {*;}
-keep class com.ss.sys.ces.* {*;}

-dontwarn com.ss.android.socialbase.downloader.**
-dontwarn com.ss.android.crash.log.**

-keep class com.qq.e.** { 
    public protected *; 
}
-keep class android.support.v4.app.NotificationCompat**{
    public *;
}
-keep class com.bun.miitmdid.core.** {*;}

```

**注意**:SDK代码被混淆后会导致广告无法展现或者其它异常。

**注意**:SDK中使用的so文件支持四种架构：x86,x86_64,armeabi-v7a,arm64-v8a, 如果您应用中支持的架构超出这 四种，请在build.gradle中使用abiFilters选择支持的架构。如下所示： 
```
ndk { // 设置支持的 SO 库构架，注意这里要根据你的实际情况来设置 
	abiFilters ‘armeabi-v7a’, ‘arm64-v8a’, ‘x86’, ‘x86_64’
}
```

## 6.广告位接入代码示例

具体可运行的代码可以参考AdvanceDemo工程。

初始化SDK代码，初始化操作一定要在广告请求之前进行。：

```java
public class MyApplication extends Application {
    @Override
    public void onCreate() {
        super.onCreate();
        //聚合SDK初始化
        AdvanceConfig.getInstance()
       			 //按需必填：只有设置了打底广告，才需要填写打底渠道的媒体参数。比如设置广点通的广告位为打底，仅需设置setGdtMediaId 即可。
                .setMercuryMediaId("你在聚合SDK平台申请的 媒体ID")
                .setMercuryMediaKey("你在聚合SDK平台申请的 媒体Key")
                .setCsjAppId("你在穿山甲平台申请的 媒体ID")
                .setAppName("你在穿山甲平台申请的 媒体应用名称")
                .setGdtMediaId("你在广点通平台申请的 媒体ID")
                //可选：设置debug开发调试模式,tag为：Advance SDK
                .setDebug(true)
                //必须：SDK初始化
                .initSDKs(this);
    }
}
```

**打底广告**：如果策略服务异常，本地打底广告策略会立即生效，避免流量损失，设置方法见广告位接入部分。如果媒体有CPT(品牌包段)的需求，请知晓打底广告的设置理论上可能会导致出现非品牌广告，酌情选择。


#### 初始化相关API说明：

| 方法名| 	方法介绍|  是否必须
|:------------- |:---------------|  :---------------|  
| initSDKs(Context context) |初始化SDK，主要是进行版本校验、oaid获取以及Mercury SDK初始化|必须
|setMercuryMediaId(String mercuryMediaId) |设置在聚合 SDK平台申请的媒体ID ，同时也是Mercury SDK的媒体ID |按需必填
|setMercuryMediaKey(String mercuryMediaKey)| 设置在聚合 SDK平台申请的媒体KEY，同时也是Mercury SDK的媒体Key |按需必填
|setCsjAppId(String csjAppId) |设置穿山甲平台申请的媒体ID|按需必填
|setAppName(String appName)|设置穿山甲平台申请的 媒体应用名称 |按需必填
|setGdtMediaId(String gdtMediaId)  |设置在广点通平台申请的媒体ID|按需必填
|setBdAppId(String bdAppId) |设置在百度百青藤平台申请的 媒体ID|按需必填
|setKsAppId(String ksAppId) |设置在快手平台申请应用的 媒体ID|按需必填
|setKsAppName(String ksAppName)|设置在快手平台申请应用的应用名称|可选参数
|setDefaultStrategyCacheTime(CacheMode defaultStrategyCacheTime) | 当启用策略缓存时才生效，设置默认的策略缓存时长，不设置默认使用CacheMode.DEFAULT。<br/> CacheMode.DEFAULT  默认的缓存时长，3天<br/> CacheMode.SHORT  较短的缓存时长，3天 <br/> CacheMode.WEEK  一周的缓存时长，7天<br/> CacheMode.MONTH  一月的缓存时长，30天 <br/> CacheMode.UNLIMIT  不限定缓存时间 <br/> ps.后台针对不同广告，会适当下发新的缓存时长，如果后台有下发SDK会选择使用下发的时长| 可选 
|setReportDelayTime(int reportDelayTime) | 设置广告上报的延迟时间，单位毫秒，最大值10000ms；默认-1不进行延迟  | 可选 
|clearCache(Context ctx) | 清除所有的策略缓存 | 可选 
|setNeedPermissionCheck(boolean needPermissionCheck)|穿山甲全局设置项 <br/> true 代表请求穿山甲广告前会进行权限检查和申请，默认false | 可选
|setSupportMultiProcess(boolean supportMultiProcess)  |穿山甲全局设置项  <br/> 是否支持多进程，true支持，默认true | 可选
|setCsjDirectDownloadNetworkType(int[] csjDirectDownloadNetworkType)  |穿山甲全局设置项 <br/> 设置穿山甲允许直接下载的网络状态集合，状态集合参考 TTAdConstant.NETWORK_STATE_XX | 可选
|setOaid(String oaid) <br/>MercuryAD.setOAID(String oaid) <br/>MercuryAD.setOAID(Context context, String oaid)|Mercury SDK 全局设置项  <br/> 设置Mercury SDK的OAID值，预留防止msa版本不一致导致获取不到OAID，导致填充低 |可选
|MercuryAD.optimizationPermissionRequest(boolean enable) <br/>MercuryAD.optimizationPermissionRequest(boolean enable, @ColorInt int actionBgColor, @ColorInt int actionTextColor) | Mercury SDK 全局设置项  <br/> 流程优化设置：是否启用优化权限申请功能，开启后将在动态权限申请时，提前一步告知权限使用目的。默认关闭 <br/> actionBgColor 代表底部按钮的背景色，<br/>actionTextColor 代表底部按钮的字体色| 可选


### 6.1开屏广告(AdvanceSplash)

集成最佳实践：

- 广告时长 5 秒为宜；
- 展示区域最好大于整体画面 75%且高度不得低于400dp，全屏效果更佳；
- 开屏请求、展示时机：APP启动页面设置为开屏Activity，加载开屏时不要同时进行其他的网络请求或耗时操作，这类操作可以在广告曝光、加载失败回调事件以后再进行。
- Mercury开屏广告常见尺寸有两种比例：1）2:3 比例，多用尺寸为 640*960、1280x1920；2） 9:16 比例，多用尺寸为 720x1280、1080x1920;



展示广告核心方法，详细请参考demo中代码：


```java
//开屏初始化；adContainer为广告容器，skipView不需要自定义可以为null
advanceSplash = new AdvanceSplash(this,  "聚合splash广告位id", adContainer, skipView);
//必须：设置开屏核心回调事件的监听器。
advanceSplash.setAdListener(this);
//必须：请求策略并请求和展示广告，如果targetSDKVersion >= 23，需要申请好权限,如果您的App没有适配到Android6.0（即targetSDKVersion < 23）或者已经提前申请权限，那么只需要在这里直接调用loadAd方法。
advanceSplash.loadStrategy();
```

#### 相关API说明：

| 方法名| 	方法介绍|  是否必须
|:------------- |:---------------|  :---------------|  
|AdvanceSplash(Activity activity, String adspotId, ViewGroup adContainer, TextView skipView) |开屏初始化方法，adspotId 为聚合广告位id同时也是Mercury 渠道的广告位id，adContainer为开屏页的展示根布局，skipView为跳过按钮的自定义view，传null代表不自定义，会使用默认的跳过按钮| 必须
|setAdListener(AdvanceSplashListener listener) | 设置开屏各个事件的回调监听器，具体回调含义参考下方AdvanceSplashListener 说明| 必须
|loadStrategy()| 加载广告策略，根据返回的渠道顺序进行请求并展示广告，注意最好是申请好权限以后再调用此方法。| 必须
|enableStrategyCache(boolean enableCache) | 是否开启策略缓存。注意这里缓存的是SDK的调度策略，而非缓存的广告信息。不设置默认关闭   | 可选，具体参考**1.6 最佳实践说明**
|setDefaultSdkSupplier(SdkSupplier defaultSdkSupplier) | 设置打底渠道，当无策略或策略异常时会进行打底渠道的展示，设置方式：setDefaultSdkSupplier(new SdkSupplier("穿山甲渠道广告位id", AdvanceSupplierID.CSJ))，第一个参数为渠道的广告位id，第二个参数为渠道id|可选，具体参考**1.6 最佳实践说明**
| setSkipText(String skipText) | 自定义跳过按钮的字体，不设置默认显示为："跳过 %d " ，%d为剩余秒数| 可选	
|以下为穿山甲 SDK 渠道特有设置
|setCsjAcceptedSize(int width, int height)|设置穿山甲广告图片偏好尺寸，单位px，不设置默认宽1080px 高1920px | 可选
|setCsjExpressViewAcceptedSize(float expressViewWidth, float expressViewHeight) |模板广告需要设置期望个性化模板广告的大小,单位dp,代码位是否属于个性化模板广告，请在穿山甲平台查看，不设置默认宽360dp，高640dp |  模板广告必须
|以下为Mercury SDK 渠道特有设置
|setLogoImage(Drawable logoImage)| 设置Mercury SDK 开屏底部logo图标 | 可选
|setHolderImage(Drawable holderImage)| 设置Mercury SDK 开屏展示占位图，当广告素材渲染中会展示此处设置的图片，不设置默认无占位 | 可选
|MercuryAD.setLargeADCutType(LargeADCutType largeADCutType) | 素材展示模式设置，不设置默认为LargeADCutType.DEFAULT 保持素材原始比例 |  可选
|MercuryAD.setSplashBackgroundColor(@ColorInt int color) | 设置开屏背景颜色，默认透明。| 可选
|MercuryAD.setSplashForceShowLogo(boolean forceShowLogo)  | 是否强制显示开屏logo，前提是设置了底部logo图标 ，默认关闭| 可选
|MercuryAD.setSplashForceLogoHeight(int forceLogoHeightDP) | 自定义强制显示的开屏logo高度，单位dp，默认-1不限制高度 | 可选
|MercuryAD.setSplashCountDownDuration(int duration) | 设置开屏倒计时时长，最低3s 最高10s| 可选
|MercuryAD.setRichSplashCountDown(boolean countDown) | 设置富媒体开屏是否进行倒计时 ，默认true| 可选
|MercuryAD.setSplashHolderShowMode(SplashHolderMode splashHolderShowMode) | 设置开屏占位图的渲染方式<br/> SplashHolderMode.DEFAULT 默认设置，使用imageView的 setBackground 方法进行图片的填充，不同手机下可能会有一点图片变形 <br/> SplashHolderMode.GlIDE 使用glide方式加载 | 可选
|以下为广点通 SDK 渠道特有设置
|setGdtSkipContainer(View gdtSkipContainer) | 设置广点通的跳过载体，传入一个默认可见view给广点通进行可见检查机制 |可选
|setGdtClickAsSkip(boolean gdtClickAsSkip) | 设置广点通的广告点击后是否以onAdSkip(跳过事件)来回调，适合跳过和倒计时结束处理逻辑不同时设置，处理逻辑相同请忽略。true 点击广点通广告关闭后回调onAdSkip，false 回调 onAdTimeOver；默认为false。| 跳过按钮有特殊处理逻辑时使用，无则忽略
|setGdtCustomSkipHide(boolean gdtCustomSkipHide) | 广点通自定义跳过是否提前隐藏，避免跳过按钮提前展示。| 可选
|setCsjTimeOutQuit(boolean csjTimeOutQuit)  | 穿山甲返回time out回调时，是否退出策略，true 退出false 继续加载下个策略，false。| 可选

* 开屏事件回调 **AdvanceSplashListener**


| 方法名| 	方法介绍|  
|:------------- |:---------------|  
|onAdLoaded()	|成功获取广告信息回调
|onAdShow()	|广告成功展示回调 
|onAdFailed(AdvanceError advanceError) 	|广告加载失败回调，此时关闭开屏跳转主页
|onAdClicked()|	广告被点击回调
|onAdSkip()|	用户跳过广告回调，此时关闭开屏跳转主页，注意处理不同渠道的跳转条件，详见demo
|onAdTimeOver()|	倒计时结束回调，此时关闭开屏跳转主页，注意处理不同渠道的跳转条件，详见demo
|onSdkSelected(String sdkID) | 当前选中的SDK渠道，sdkID对应 **1.4 SDK渠道平台信息**中的SDK ID


### 6.2横幅广告(AdvanceBanner)

集成最佳实践：

- 适用场景：一般会在 APP 页面的底部或中部呈现。
- 常见尺寸：640*100 是最常见的 Banner 尺寸。
- 



请求广告核心方法，详细请参考demo中代码：


```java
//rl是banner的父布局，用来展示广告
advanceBanner = new AdvanceBanner(this, rl, "聚合banner广告位id");
//推荐：核心事件监听回调
advanceBanner.setAdListener(this);
//必须：请求策略并请求和展示广告
advanceBanner.loadStrategy();
```

#### 相关API说明：

| 方法名| 	方法介绍|  是否必须
|:------------- |:---------------|  :---------------|  
|AdvanceBanner(Activity activity, ViewGroup adContainer, String adspotId) | 广告初始化方法，adContainer是广告的展示父布局，adspotId为聚合广告位id同时也是Mercury 渠道的广告位id | 必须
|setAdListener(AdvanceBannerListener listener) | 设置各个事件的回调监听器，具体回调含义参考下方AdvanceBannerListener 说明| 必须
|loadStrategy()| 加载广告策略，根据返回的渠道顺序进行请求并展示广告。| 必须
|destroy() | 销毁广告，页面销毁的时候要调用此方法 | 必须
|enableStrategyCache(boolean enableCache) | 是否开启策略缓存。注意这里缓存的是SDK的调度策略，而非缓存的广告信息。不设置默认关闭  <br/>后台广告位 |  可选，具体参考**1.6 最佳实践说明**
|setDefaultSdkSupplier(SdkSupplier defaultSdkSupplier) | 设置打底渠道，当无策略或策略异常时会进行打底渠道的展示，设置方式：setDefaultSdkSupplier(new SdkSupplier("穿山甲渠道广告位id", AdvanceSupplierID.CSJ))，第一个参数为渠道的广告位id，第二个参数为渠道id| 可选，具体参考**1.6 最佳实践说明**
|setRefreshInterval(int refreshInterval) | 设置刷新间隔（单位秒），不设置默认不刷新| 可选
|setAdListener(AdvanceBannerListener listener) | 设置广告事件的回调监听 | 可选
|以下为穿山甲 SDK 渠道特有设置
|setCsjAcceptedSize(int width, int height)  | 设置穿山甲广告图片偏好尺寸，单位px，不设置默认宽640px，高100px | 可选
|setCsjExpressViewAcceptedSize(int width, int height)  | 模板广告需要设置期望个性化模板广告的大小,单位dp,代码位是否属于个性化模板广告，请在穿山甲平台查看，不设置默认宽640dp，高100dp | 模板广告必须


* 事件回调 **AdvanceBannerListener**

| 方法名| 	方法介绍|  
|:------------- |:---------------|  
|onAdLoaded()	|成功获取广告信息回调
|onAdShow()	|广告成功展示回调 
|onAdFailed(AdvanceError advanceError) 	|广告加载失败回调
|onAdClicked()|	广告被点击回调
|onDislike()|	用户关闭广告回调
|onSdkSelected(String sdkID) | 当前选中的SDK渠道，sdkID对应 **1.4 SDK渠道平台信息**中的SDK ID


 
### 6.3插屏(AdvanceInterstitial)


聚合了Mercury，广点通，穿山甲的广告位。

请求广告核心方法，详细请参考demo中代码：


```java
/初始化广告
advanceInterstitial = new AdvanceInterstitial(this, "聚合插屏广告位id");
//推荐：核心事件监听回调
advanceInterstitial.setAdListener(this);
//必须：请求策略并请求广告
advanceInterstitial.loadStrategy();
```

展示广告

```java
//广告加载成功回调
@Override
public void onAdReady() {
    //展示广告
    advanceInterstitial.show();
}
```

#### 相关API说明：

| 方法名| 	方法介绍|  是否必须
|:------------- |:---------------|  :---------------|  
| AdvanceInterstitial(Activity activity,String adspotId) | 广告初始化方法，adspotId为聚合广告位id同时也是Mercury 渠道的广告位id | 必须
|setAdListener(AdvanceInterstitialListener listener) | 设置各个事件的回调监听器，具体回调含义参考下方AdvanceInterstitialListener 说明| 可选
|loadStrategy()| 加载广告策略，根据返回的渠道顺序进行请求并展示广告。| 必须
|enableStrategyCache(boolean enableCache) | 是否开启策略缓存。注意这里缓存的是SDK的调度策略，而非缓存的广告信息。不设置默认关闭  <br/>后台广告位 |  可选，具体参考**1.6 最佳实践说明**
|setDefaultSdkSupplier(SdkSupplier defaultSdkSupplier) | 设置打底渠道，当无策略或策略异常时会进行打底渠道的展示，设置方式：setDefaultSdkSupplier(new SdkSupplier("穿山甲渠道广告位id", AdvanceSupplierID.CSJ))，第一个参数为渠道的广告位id，第二个参数为渠道id| 可选，具体参考**1.6 最佳实践说明**
|setGdtMediaListener(UnifiedInterstitialMediaListener listener) | 广点通渠道特有设置，设置广点通的视频广告的播放回调。| 可选
|setCsjExpressViewAcceptedSize(float expressViewWidth, float expressViewHeight) |穿山甲渠道特有设置，期望模板广告view的size,单位dp。高度为0代表自适应，不设置默认宽高为300dp | 可选


* 事件回调 **AdvanceInterstitialListener**

| 方法名| 	方法介绍|  
|:------------- |:---------------|  
|onAdReady()	|成功获取广告信息回调，广告准备就绪
|onAdShow()	|广告成功展示回调 
|onAdFailed(AdvanceError advanceError) 	|广告加载失败回调
|onAdClicked()|	广告被点击回调
|onAdClose()|	用户关闭广告回调
|onSdkSelected(String sdkID) | 当前选中的SDK渠道，sdkID对应 **1.4 SDK渠道平台信息**中的SDK ID



### 6.4原生模板(AdvanceNativeExpress)

聚合了Mercury，广点通，穿山甲的广告位。 RecyclerView中使用的话请参考示例工程中的NativeExpressRecyclerViewActivity。

请求广告核心方法，详细请参考demo中代码：


```java
/初始化广告
advanceNativeExpress = new AdvanceNativeExpress(this, "聚合模板信息流广告位id");
//推荐：核心事件监听回调
advanceNativeExpress.setAdListener(this);
//必须：请求策略并请求广告
advanceNativeExpress.loadStrategy();
```

展示广告

```java
//广告加载成功回调
@Override
public void onAdLoaded(List<AdvanceNativeExpressAdItem> list) {
    Toast.makeText(this, "广告加载成功", Toast.LENGTH_SHORT).show();
    Log.d("DEMO", "LOADED");
    if (null == list || list.isEmpty()) {
        Log.d("DEMO", "NO AD RESULT");
    } else {
        AdvanceNativeExpressAdItem advanceNativeExpressAdItem = list.get(0);
        container.removeAllViews();
        container.setVisibility(View.VISIBLE);

        container.addView(advanceNativeExpressAdItem.getExpressAdView());
        // 广告可见才会产生曝光，否则将无法产生收益。
        advanceNativeExpressAdItem.render();
    }
}
```


#### 相关API说明：

请求策略、加载广告相关API（AdvanceNativeExpress）

| 方法名| 	方法介绍|  是否必须
|:------------- |:---------------|  :---------------|  
| AdvanceNativeExpress(Activity activity,String adspotId) | 广告初始化方法，adspotId为聚合广告位id同时也是Mercury 渠道的广告位id | 必须
|setAdListener(AdvanceNativeExpressListener listener) | 设置各个事件的回调监听器，具体回调含义参考下方AdvanceNativeExpressListener 说明| 可选
|loadStrategy()| 加载广告策略，根据返回的渠道顺序进行请求并展示广告。| 必须
|enableStrategyCache(boolean enableCache) | 是否开启策略缓存。注意这里缓存的是SDK的调度策略，而非缓存的广告信息。不设置默认关闭  <br/>后台广告位 |  可选，具体参考**1.6 最佳实践说明**
|setDefaultSdkSupplier(SdkSupplier defaultSdkSupplier) | 设置打底渠道，当无策略或策略异常时会进行打底渠道的展示，设置方式：setDefaultSdkSupplier(new SdkSupplier("穿山甲渠道广告位id", AdvanceSupplierID.CSJ))，第一个参数为渠道的广告位id，第二个参数为渠道id| 可选，具体参考**1.6 最佳实践说明**
|setExpressViewAcceptedSize(int width, int height)   | 设置期望的模板广告view的size,单位dp，同时适用于穿山甲、广点通、Mercury。不设置默认宽600dp 高 300dp，如果高度设置为0,则高度会自适应 | 可选
|setCsjImageAcceptedSize(int width, int height)  |穿山甲渠道特有设置，设置图片偏好尺寸，单位px，不设置默认宽640px  高320px | 可选
|setGdtFullWidth(boolean isFullWidth) | 广点通、Mercury 渠道特有设置，设置是否宽度占满，默认true | 可选
|setGdtAutoHeight(boolean isAutoHeight) | 广点通、Mercury 渠道特有设置，设置是否高度自适应，默认true | 可选
|setGdtMaxVideoDuration(int gdtMaxVideoDuration) | 广点通渠道特有设置，设置返回视频广告的最大视频时长（闭区间，可单独设置），单位:秒，合法输入为：5<=maxVideoDuration<=60. 此设置会影响广告填充，请谨慎设置，不设置默认60 | 可选

信息流子View相关API（AdvanceNativeExpressAdItem）

| 方法名| 	方法介绍
|:------------- |:---------------
|String getSdkId()   | 获取当前加载的SDK渠道，"1" 为Mercury渠道，"2" 为广点通渠道，"3" 为穿山甲渠道 
| destroy() | 销毁当前展示的信息流子View以及资源占用回收
|View getExpressAdView() | 获取当前信息流的广告视图View 
|render() | 渲染视图



* 事件回调 **AdvanceNativeExpressListener**

| 方法名| 	方法介绍|  
|:------------- |:---------------|  
|onAdLoaded(List<AdvanceNativeExpressAdItem> list) |成功获取广告信息回调，广告准备就绪
|onAdFailed(AdvanceError advanceError)  | 获取广告信息失败回调
|onAdShow(View view) |  广告素材展示成功回调，view是当前展示成功的视图
|onAdRenderSuccess(View view)	|广告渲染成功回调，不一定曝光了 
|onAdRenderFailed(View view) |广告渲染失败回调
|onAdClicked(View view)|	广告被点击回调
|onAdClose(View view)|	用户关闭广告回调
|onSdkSelected(String sdkID) | 当前选中的SDK渠道，sdkID对应 **1.4 SDK渠道平台信息**中的SDK ID



### 6.5激励视频(RewardVideo)

聚合了Mercury，广点通，穿山甲的广告位。

加载广告核心方法，详细请参考demo中代码：


```java
/初始化广告
advanceRewardVideo = new AdvanceRewardVideo(this,"聚合激励视频广告位id");
//如果穿山甲版本号大于3.2.5.1，模板广告需要设置期望个性化模板广告的大小,单位dp,激励视频场景，只要设置的值大于0即可
advanceRewardVideo.setCsjExpressSize(500,500);
//设置通用事件监听器
advanceRewardVideo.setAdListener(this);
//必须：请求策略并请求广告
advanceNativeExpress.loadStrategy();
```

展示广告，以下代码表示收到广告立即展示。也可以选择提前加载好再展示，但要注意激励视频有失效时间，且一次load 对应一次show。


```java
//广告加载成功回调
@Override
public void onAdLoaded(AdvanceRewardVideoItem advanceRewardVideoItem) {
    isReady = true;
    Log.d("DEMO", "LOADED");
    this.advanceRewardVideoItem = advanceRewardVideoItem;
    Toast.makeText(this, "广告加载成功", Toast.LENGTH_SHORT).show();
    //展示广告
    advanceRewardVideoItem.showAd();
}
```


#### 相关API说明：

请求策略、加载广告相关API（AdvanceRewardVideo）

| 方法名| 	方法介绍|  是否必须
|:------------- |:---------------|  :---------------|  
| AdvanceRewardVideo(Activity activity,String adspotId) | 广告初始化方法，adspotId为聚合广告位id同时也是Mercury 渠道的广告位id | 必须
|setAdListener(AdvanceRewardVideoListener listener) | 设置各个事件的回调监听器，具体回调含义参考下方AdvanceRewardVideoListener 说明| 可选
|loadStrategy()| 加载广告策略，根据返回的渠道顺序进行请求并展示广告。| 必须
|enableStrategyCache(boolean enableCache) | 是否开启策略缓存。注意这里缓存的是SDK的调度策略，而非缓存的广告信息。不设置默认关闭  <br/>后台广告位 |  可选，具体参考**1.6 最佳实践说明**
|setDefaultSdkSupplier(SdkSupplier defaultSdkSupplier) | 设置打底渠道，当无策略或策略异常时会进行打底渠道的展示，设置方式：setDefaultSdkSupplier(new SdkSupplier("穿山甲渠道广告位id", AdvanceSupplierID.CSJ))，第一个参数为渠道的广告位id，第二个参数为渠道id| 可选，具体参考**1.6 最佳实践说明**
|setCsjImageAcceptedSize(int width, int height) | 穿山甲渠道特有设置，设置穿山甲广告图片偏好尺寸，单位px，不设置默认宽1080px，高1920px | 可选
|setCsjRewardName(String rewardName) |  穿山甲渠道特有设置，设置奖励的名称，不设置默认空字符串 | 可选
|setCsjRewardAmount(int rewardAmount) |  穿山甲渠道特有设置，设置奖励的数量，不设置默认1 | 可选
|setCsjUserId(String userId) | 穿山甲渠道特有设置，标识应用侧唯一用户；若非服务器回调模式或不需sdk透传可设置为空字符串，不设置默认空字符串  | 可选
|setOrientation(int orientation) | 穿山甲渠道特有设置，设置期望视频播放的方向，为TTAdConstant.HORIZONTAL或TTAdConstant.VERTICAL（默认值）  | 可选
|setCsjMediaExtra(String mediaExtra) | 穿山甲渠道特有设置，用户透传的信息，可不传，默认空字符串  | 可选
|setCsjExpressSize(int width, int height) | 模板广告需要设置期望个性化模板广告的大小，单位dp，只要设置的值大于0即可  | 可选，如果穿山甲版本号大于3.2.5.1为必须


* 事件回调 **AdvanceRewardVideoListener**

| 方法名| 	方法介绍|  
|:------------- |:---------------|  
|onAdLoaded(AdvanceRewardVideoItem advanceRewardVideoItem) |成功获取广告信息回调，广告准备就绪
|onAdFailed(AdvanceError advanceError)  | 获取广告信息失败回调
|onAdShow() |  激励视频页面展示成功回调
|onVideoCached()	|视频缓冲成功回调
|onVideoComplete() | 视频播放完成回调
|onAdClicked()|	广告被点击回调
|onAdClose()|	用户关闭广告回调
| onAdReward()|	激励发放回调
|onSdkSelected(String sdkID) | 当前选中的SDK渠道，sdkID对应 **1.4 SDK渠道平台信息**中的SDK ID


* 基础激励视频实现类 **AdvanceRewardVideoItem**

方法名| 	方法介绍|  
|:------------- |:---------------|  
|String getSdkId() | 获取当前加载的SDK渠道，"1" 为Mercury渠道，"2" 为广点通渠道，"3" 为穿山甲渠道 
|showAd() | 展示当前激励视频广告

### 6.6 全屏视频(FullScreenVideo)


聚合了Mercury，广点通，穿山甲的广告位。展示样式基本与激励视频一致，不同是可以提前关闭。

加载广告核心方法，详细请参考demo中代码：


```java
/初始化广告
advanceFullScreenVideo = new AdvanceFullScreenVideo(this, "聚合全屏视频广告位id");
//如果穿山甲版本号大于3.2.5.1，模板广告需要设置期望个性化模板广告的大小,单位dp,全屏视频场景，只要设置的值大于0即可
advanceFullScreenVideo.setCsjExpressSize(500,500);
//推荐：核心事件监听回调
advanceFullScreenVideo.setAdListener(this);
//必须：请求策略并请求广告
advanceNativeExpress.loadStrategy();
```

展示广告

```java
//广告加载成功回调
@Override
public void onAdLoaded(AdvanceFullScreenItem advanceFullScreenItem) {
    Log.d(TAG, "onAdLoaded");
    //展示广告
    advanceNativeExpress.showAd();
}
```


#### 相关API说明：

请求策略、加载广告相关API（AdvanceFullScreenVideo）

| 方法名| 	方法介绍|  是否必须
|:------------- |:---------------|  :---------------|  
| AdvanceRewardVideo(Activity activity,String adspotId) | 广告初始化方法，adspotId为聚合广告位id同时也是Mercury 渠道的广告位id | 必须
|setAdListener(AdvanceFullScreenVideoListener listener) | 设置各个事件的回调监听器，具体回调含义参考下方AdvanceFullScreenVideoListener 说明| 可选
|loadStrategy()| 加载广告策略，根据返回的渠道顺序进行请求并展示广告。| 必须
|enableStrategyCache(boolean enableCache) | 是否开启策略缓存。注意这里缓存的是SDK的调度策略，而非缓存的广告信息。不设置默认关闭  <br/>后台广告位 |  可选，具体参考**1.6 最佳实践说明**
|setDefaultSdkSupplier(SdkSupplier defaultSdkSupplier) | 设置打底渠道，当无策略或策略异常时会进行打底渠道的展示，设置方式：setDefaultSdkSupplier(new SdkSupplier("穿山甲渠道广告位id", AdvanceSupplierID.CSJ))，第一个参数为渠道的广告位id，第二个参数为渠道id| 可选，具体参考**1.6 最佳实践说明**
|setGdtMediaListener(UnifiedInterstitialMediaListener mediaListener) | 广点通渠道特有设置， 设置广点通媒体播放状态监听| 可选
|setGdtVideoOption(VideoOption videoOption)| 广点通渠道特有设置，设置广点通视频播放策略| 可选
|setCsjExpressSize(int width, int height) | 模板广告需要设置期望个性化模板广告的大小，单位dp，只要设置的值大于0即可  | 可选，如果穿山甲版本号大于3.2.5.1为必须



* 事件回调 **AdvanceFullScreenVideoListener**

| 方法名| 	方法介绍|  
|:------------- |:---------------|  
|onAdLoaded(AdvanceFullScreenItem advanceFullScreenItem) |成功获取广告信息回调，广告准备就绪
|onAdFailed(AdvanceError advanceError)  | 获取广告信息失败回调
|onAdShow() |  视频页面展示成功回调
|onVideoCached()	|视频缓冲成功回调
|onVideoSkipped()	|视频跳过回调
|onVideoComplete() | 视频播放完成回调
|onAdClicked()|	广告被点击回调
|onAdClose()|	用户关闭广告回调
|onSdkSelected(String sdkID) | 当前选中的SDK渠道，sdkID对应 **1.4 SDK渠道平台信息**中的SDK ID

* 基础全屏视频实现类 **AdvanceFullScreenItem**

方法名| 	方法介绍|  
|:------------- |:---------------|  
|String getSdkId() | 获取当前加载的SDK渠道，"1" 为Mercury渠道，"2" 为广点通渠道，"3" 为穿山甲渠道 
|showAd() | 展示当前激励视频广告





## 7.自定义广告

非自定义的各个广告位是由我们Advance SDK来默认实现了通用的需求，且广告位和SDK渠道位比较固定，比较适合希望快速实现的客户；自定义广告位是广告的具体实现和展示由客户端来决定，这样可以满足客户端的多样性需求，而Advance SDK主要来负责策略（使用哪个SDK加载广告的策略）的下发和数据统计上报，客户端需要适配开发，比较适合希望实现自渲染广告等多样性格式广告或者需要除 上面1.3表格中支持的渠道以外的需求。

目前自定义广告可以实现SDK渠道和广告位的自定义，但暂未开放给客户自己添加的权限，如果需要新增渠道或者广告位烦请联系我们。

 
### 7.1 原生自渲染广告自定义示例

#### 自定义原生自渲染广告初始化

和自定义开屏示例一样， 初始化`AdvanceCustomizeAd`后，策略加载成功回调中初始化各渠道adapter，并请求广告。

原生自渲染activity示例：

```
public class NativeCustomizeActivity extends Activity {

    AdvanceCustomizeAd nativeCustomizeAd;
    FrameLayout fl;
    String Tag = NativeCustomizeActivity.class.getSimpleName();

    @Override
    protected void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_ad_container);
        fl = findViewById(R.id.fl_ad);

        //创建自己的自渲染广告位，第二个参数为后台申请的广告位id
        nativeCustomizeAd = new AdvanceCustomizeAd(this, "");
        //必须：设置广告载体
        nativeCustomizeAd.setSupplierListener(new AdvanceCustomizeSupplierListener() {
            @Override
            public void onSupplierFailed(AdvanceError advanceError)  {
                //一般是策略无填充，或者所有策略均加载失败时回调
                fl.removeAllViews();
            }

            @Override
            public void onSupplierSelected(SdkSupplier selectedSupplier) {
                //策略选择回调，可根据不同的渠道ID来加载各渠道广告
                switch (selectedSupplier.id) {
                    case AdvanceConfig.SDK_ID_CSJ:
                        new MyCsjNCAdapter(NativeCustomizeActivity.this, nativeCustomizeAd, selectedSupplier, fl).loadAd();
                        break;
                    case AdvanceConfig.SDK_ID_GDT:
                        new MyGdtNCAdapter(NativeCustomizeActivity.this, nativeCustomizeAd, selectedSupplier, fl).loadAd();
                        break;
                    case AdvanceConfig.SDK_ID_MERCURY:
                        new MyMercuryNCAdapter(NativeCustomizeActivity.this, nativeCustomizeAd, selectedSupplier, fl).loadAd();
                        break;
                    default:
                        //不需要支持的渠道，建议选择重新调度策略
                        nativeCustomizeAd.selectSdkSupplier();
                }
            }
        });
//        发起策略请求
        nativeCustomizeAd.loadStrategy();
    }


}
```

#### 设置各个渠道的adapter

渠道adapter来负责各个渠道的广告加载流程，这里以穿山甲渠道`MyCsjNCAdapter`的实现为例，其他渠道请下载demo工程参考具体的实现。

<font size = "2">**注意**：一定要按照示例调用customizeAd 的对应事件方法

```

public class MyCsjNCAdapter implements TTAdNative.FeedAdListener {

    private Activity activity;
    private SdkSupplier sdkSupplier;
    private AdvanceCustomizeAd customizeAd;
    private ViewGroup adContainer;

    public MyCsjNCAdapter(Activity activity, AdvanceCustomizeAd customizeAd, SdkSupplier sdkSupplier, ViewGroup adContainer) {
        this.activity = activity;
        this.customizeAd = customizeAd;
        this.sdkSupplier = sdkSupplier;
        this.adContainer = adContainer;
    }

    public void loadAd() {
        //初始化advance默认的穿山甲配置，也可以自己选择初始化方式
        AdvanceUtil.initCsj(activity, sdkSupplier.mediaid);

        TTAdManager ttAdManager = TTAdSdk.getAdManager();
        if (AdvanceConfig.getInstance().isNeedPermissionCheck()) {
            ttAdManager.requestPermissionIfNecessary(activity);
        }
        TTAdNative ttAdNative = ttAdManager.createAdNative(activity);
        //step3:(可选，强烈建议在合适的时机调用):申请部分权限，如read_phone_state,防止获取不了imei时候，下载类广告没有填充的问题。
        ttAdManager.requestPermissionIfNecessary(activity);
        //step4:创建feed广告请求类型参数AdSlot,具体参数含义参考文档
        AdSlot adSlot = new AdSlot.Builder()
                // 必选参数 设置您的CodeId
                .setCodeId(sdkSupplier.adspotid)
                // 必选参数 设置广告图片的最大尺寸及期望的图片宽高比，单位Px
                .setImageAcceptedSize(640, 320)
                // 可选参数 设置是否支持deeplink
                .setSupportDeepLink(true)
                .setAdCount(sdkSupplier.adCount) //请求广告数量为1到3条
                .build();
        ttAdNative.loadFeedAd(adSlot, this);
    }

    @Override
    public void onError(int code, String message) {
        //这里一定要调用customizeAd 的事件方法
        if (customizeAd != null)
            customizeAd.adapterDidFailed(AdvanceError.parseErr(code, message));
    }


    @Override
    public void onFeedAdLoad(List<TTFeedAd> ads) {
        if (ads == null || ads.isEmpty()) {
            //这里一定要调用customizeAd 的事件方法
            if (customizeAd != null)
                customizeAd.adapterDidFailed(AdvanceError.parseErr(ERROR_DATA_NULL));
        } else {
            //这里一定要调用customizeAd 的事件方法
            if (customizeAd != null)
                customizeAd.adapterDidSucceed();

            CsjAdData advanceNativeAdData = new CsjAdData(ads.get(0));
            advanceNativeAdData.showAd();
        }
    }

    class CsjAdData {
        private View adView;
        TTFeedAd ad;

        ImageView mIcon;
        ImageView mDislike;
        Button mCreativeButton;
        TextView mTitle;
        TextView mDescription;
        TextView mSource;

        ImageView mGroupImage1;
        ImageView mGroupImage2;
        ImageView mGroupImage3;
        LinearLayout mGroupContainer;

        private FrameLayout videoLayout;
        private ImageView mImagePoster;
        private ImageView mSmallImagePoster;
        private LinearLayout nativeContainer;
        private Map<CsjAdData, TTAppDownloadListener> mTTAppDownloadListenerMap = new WeakHashMap<>();
        String TAG = "CsjAdData";

        public CsjAdData(TTFeedAd adData) {
            this.ad = adData;

            try {
                //小图布局不太一样
                if (ad.getImageMode() == TTAdConstant.IMAGE_MODE_SMALL_IMG) {
                    adView = LayoutInflater.from(activity).inflate(R.layout.csj_nc_layout_small, null, false);
                } else {
                    adView = LayoutInflater.from(activity).inflate(R.layout.csj_nc_layout, null, false);
                }
                initViews();
            } catch (Exception e) {
                e.printStackTrace();
                //这里一定要调用customizeAd 的事件方法
                if (customizeAd != null)
                    customizeAd.adapterDidFailed(AdvanceError.parseErr(ERROR_EXCEPTION_LOAD));
            }
        }

        private void initViews() {
            mIcon = adView.findViewById(R.id.iv_nc_icon);
            mDislike = adView.findViewById(R.id.iv_nc_dislike);
            mCreativeButton = adView.findViewById(R.id.btn_nc_creative);
            mTitle = adView.findViewById(R.id.tv_nc_ad_title);
            mDescription = adView.findViewById(R.id.tv_nc_ad_desc);
            mSource = adView.findViewById(R.id.tv_nc_ad_source);


            nativeContainer = adView.findViewById(R.id.native_ad_container);

            if (ad.getImageMode() == TTAdConstant.IMAGE_MODE_SMALL_IMG) {
                mSmallImagePoster = adView.findViewById(R.id.iv_nc_small_image);
            } else {
                mGroupContainer = adView.findViewById(R.id.native_3img);
                mGroupImage1 = adView.findViewById(R.id.img_1);
                mGroupImage2 = adView.findViewById(R.id.img_2);
                mGroupImage3 = adView.findViewById(R.id.img_3);

                videoLayout = adView.findViewById(R.id.iv_nc_video);
                mImagePoster = adView.findViewById(R.id.img_poster);
            }

        }

        public void showAd() {
            try {
                if (adContainer == null) {
                    Log.e(TAG, "广告位载体为空，请检查载体设置");
                    return;
                }
                adContainer.removeAllViews();
                //设置dislike弹窗，这里展示自定义的dialog
                bindDislikeCustom(ad);

                bindData(ad);
                adContainer.addView(adView);

            } catch (Exception e) {
                e.printStackTrace();
                //这里一定要调用customizeAd 的事件方法
                if (customizeAd != null)
                    customizeAd.adapterDidFailed(AdvanceError.parseErr(ERROR_EXCEPTION_SHOW));
            }
        }

        private void bindData(TTFeedAd ad) {
            //可以被点击的view, 也可以把adView放进来意味整个布局可被点击
            List<View> clickViewList = new ArrayList<>();
            clickViewList.add(adView);
            //触发创意广告的view（点击下载或拨打电话）
            List<View> creativeViewList = new ArrayList<>();
            creativeViewList.add(mCreativeButton);
            //如果需要点击图文区域也能进行下载或者拨打电话动作，请将图文区域的view传入
//            creativeViewList.add(convertView);
            //重要! 这个涉及到广告计费，必须正确调用。convertView必须使用ViewGroup。
            ad.registerViewForInteraction((ViewGroup) adView, clickViewList, creativeViewList, new TTNativeAd.AdInteractionListener() {
                @Override
                public void onAdClicked(View view, TTNativeAd ad) {
                    //这里一定要调用customizeAd 的事件方法
                    if (customizeAd != null)
                        customizeAd.adapterDidClicked();
                }

                @Override
                public void onAdCreativeClick(View view, TTNativeAd ad) {
                    //这里一定要调用customizeAd 的事件方法
                    if (customizeAd != null)
                        customizeAd.adapterDidClicked();
                }

                @Override
                public void onAdShow(TTNativeAd ad) {
                    //这里一定要调用customizeAd 的事件方法
                    if (customizeAd != null)
                        customizeAd.adapterDidShow();
                }
            });
            mTitle.setText(ad.getTitle()); //title为广告的简单信息提示
            mDescription.setText(ad.getDescription()); //description为广告的较长的说明
            mSource.setText(ad.getSource() == null ? "广告来源" : ad.getSource());
            TTImage icon = ad.getIcon();
            if (icon != null && icon.isValid()) {
                Glide.with(activity).load(icon.getImageUrl()).into(mIcon);
            }

            switch (ad.getImageMode()) {
                case TTAdConstant.IMAGE_MODE_SMALL_IMG:
                    if (ad.getImageList() != null && !ad.getImageList().isEmpty()) {
                        TTImage image = ad.getImageList().get(0);
                        if (image != null && image.isValid()) {
                            Glide.with(activity).load(image.getImageUrl()).into(mSmallImagePoster);
                        }
                    }

                    break;
                case TTAdConstant.IMAGE_MODE_LARGE_IMG:
                case TTAdConstant.IMAGE_MODE_VERTICAL_IMG:
                    if (ad.getImageList() != null && !ad.getImageList().isEmpty()) {
                        TTImage image = ad.getImageList().get(0);
                        if (image != null && image.isValid()) {
                            Glide.with(activity).load(image.getImageUrl()).into(mImagePoster);
                        }
                    }

                    mImagePoster.setVisibility(View.VISIBLE);
                    videoLayout.setVisibility(View.GONE);
                    mGroupContainer.setVisibility(View.GONE);
                    break;
                case TTAdConstant.IMAGE_MODE_VIDEO:

                    videoLayout.setVisibility(View.VISIBLE);
                    mGroupContainer.setVisibility(View.GONE);
                    mImagePoster.setVisibility(View.GONE);
                    //视频广告设置播放状态回调（可选）
                    ad.setVideoAdListener(new TTFeedAd.VideoAdListener() {
                        @Override
                        public void onVideoLoad(TTFeedAd ad) {

                        }

                        @Override
                        public void onVideoError(int errorCode, int extraCode) {

                        }

                        @Override
                        public void onVideoAdStartPlay(TTFeedAd ad) {

                        }

                        @Override
                        public void onVideoAdPaused(TTFeedAd ad) {

                        }

                        @Override
                        public void onVideoAdContinuePlay(TTFeedAd ad) {

                        }

                        @Override
                        public void onProgressUpdate(long current, long duration) {
                            Log.e("VideoAdListener", "===onProgressUpdate current:" + current + " duration:" + duration);
                        }

                        @Override
                        public void onVideoAdComplete(TTFeedAd ad) {
                            Log.e("VideoAdListener", "===onVideoAdComplete");
                        }
                    });
                    if (videoLayout != null) {
                        View video = ad.getAdView();
                        if (video != null) {
                            if (video.getParent() == null) {
                                videoLayout.removeAllViews();
                                videoLayout.addView(video);
                            }
                        }
                    }
                    break;
                case TTAdConstant.IMAGE_MODE_GROUP_IMG:
                    if (ad.getImageList() != null && ad.getImageList().size() >= 3) {
                        TTImage image1 = ad.getImageList().get(0);
                        TTImage image2 = ad.getImageList().get(1);
                        TTImage image3 = ad.getImageList().get(2);
                        if (image1 != null && image1.isValid()) {
                            Glide.with(activity).load(image1.getImageUrl()).into(mGroupImage1);
                        }
                        if (image2 != null && image2.isValid()) {
                            Glide.with(activity).load(image2.getImageUrl()).into(mGroupImage2);
                        }
                        if (image3 != null && image3.isValid()) {
                            Glide.with(activity).load(image3.getImageUrl()).into(mGroupImage3);
                        }

                        mGroupContainer.setVisibility(View.VISIBLE);
                        videoLayout.setVisibility(View.GONE);
                        mImagePoster.setVisibility(View.GONE);
                    }
                    break;
            }

            switch (ad.getInteractionType()) {
                case TTAdConstant.INTERACTION_TYPE_DOWNLOAD:
                    //如果初始化ttAdManager.createAdNative(getApplicationContext())没有传入activity 则需要在此传activity，否则影响使用Dislike逻辑
                    ad.setActivityForDownloadApp(activity);
                    mCreativeButton.setVisibility(View.VISIBLE);
                    bindDownloadListener(mCreativeButton, ad);
                    break;
                case TTAdConstant.INTERACTION_TYPE_DIAL:
                    mCreativeButton.setVisibility(View.VISIBLE);
                    mCreativeButton.setText("立即拨打");
                    break;
                case TTAdConstant.INTERACTION_TYPE_LANDING_PAGE:
                case TTAdConstant.INTERACTION_TYPE_BROWSER:
                    mCreativeButton.setVisibility(View.VISIBLE);
                    mCreativeButton.setText("查看详情");
                    break;
                default://                    交互类型异常
                    mCreativeButton.setVisibility(View.GONE);
            }


        }

        private void bindDislikeCustom(TTFeedAd ad) {
            List<FilterWord> words = ad.getFilterWords();
            if (words == null || words.isEmpty()) {
                return;
            }

            final DislikeDialog dislikeDialog = new DislikeDialog(activity, words);
            dislikeDialog.setOnDislikeItemClick(new DislikeDialog.OnDislikeItemClick() {
                @Override
                public void onItemClick(FilterWord filterWord) {
                    //布局清除
                    if (adContainer != null)
                        adContainer.removeAllViews();
                }
            });
            final TTAdDislike ttAdDislike = ad.getDislikeDialog(dislikeDialog);

            mDislike.setOnClickListener(new View.OnClickListener() {
                @Override
                public void onClick(View v) {
                    //展示dislike可以自行调用dialog
                    dislikeDialog.show();

                    //也可以使用接口来展示
                    //ttAdDislike.showDislikeDialog();
                }
            });
        }

        private void bindDownloadListener(final Button adCreativeButton, TTFeedAd ad) {
            TTAppDownloadListener downloadListener = new TTAppDownloadListener() {
                @Override
                public void onIdle() {
                    if (!isValid()) {
                        return;
                    }
                    adCreativeButton.setText("开始下载");

                }

                @SuppressLint("SetTextI18n")
                @Override
                public void onDownloadActive(long totalBytes, long currBytes, String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    if (totalBytes <= 0L) {
                        adCreativeButton.setText("0%");
                    } else {
                        adCreativeButton.setText((currBytes * 100 / totalBytes) + "%");
                    }

                }

                @SuppressLint("SetTextI18n")
                @Override
                public void onDownloadPaused(long totalBytes, long currBytes, String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    if (totalBytes <= 0L) {
                        adCreativeButton.setText("0%");
                    } else {
                        adCreativeButton.setText((currBytes * 100 / totalBytes) + "%");
                    }

                }

                @Override
                public void onDownloadFailed(long totalBytes, long currBytes, String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    adCreativeButton.setText("重新下载");

                }

                @Override
                public void onInstalled(String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    adCreativeButton.setText("点击打开");

                }

                @Override
                public void onDownloadFinished(long totalBytes, String fileName, String appName) {
                    if (!isValid()) {
                        return;
                    }
                    adCreativeButton.setText("点击安装");

                }

                @SuppressWarnings("BooleanMethodIsAlwaysInverted")
                private boolean isValid() {
                    return mTTAppDownloadListenerMap.get(CsjAdData.this) == this;
                }
            };
            //一个ViewHolder对应一个downloadListener, isValid判断当前ViewHolder绑定的listener是不是自己
            ad.setDownloadListener(downloadListener); // 注册下载监听器
            mTTAppDownloadListenerMap.put(CsjAdData.this, downloadListener);
        }

    }
}

```

###  7.2 其他自定义广告

自定义开屏和自定义自渲染原理类似，具体代码请参考最新demo中的`CustomSplashActivity`类文件。

自定义激励视频和自定义自渲染原理类似，具体代码请参考最新demo中的`CustomRewardActivity`类文件。

自定义横幅广告和自定义自渲染原理类似，具体代码请参考最新demo中的`CustomBannerActivity`类文件。

自定义插屏广告和自定义自渲染原理类似，具体代码请参考最新demo中的`CustomInterstitialActivity`类文件。

自定义模板信息流广告自定义自渲染原理类似，具体代码请参考最新demo中的`CustomNativeExpressListActivity`类文件。

自定义全屏视频广告自定义自渲染原理类似，具体代码请参考最新demo中的`CustomFullScreenActivity`类文件。

 
### 7.3 自定义广告注意事项

* 1.确保广告各个展示周期（加载、展示、点击、失败）的事件上报正常，调用方法分别是 adapterDidSucceed()，adapterDidShow()， adapterDidClicked()，adapterDidFailed()。

* 2.在自定义渠道信息时，如果`selectedSupplier`返回了未实现的渠道id（即不可用渠道），需要调用`AdvanceCustomizeAd.selectSdkSupplier()`重启策略选择方法，寻找下一个可用的SDK渠道策略。

* 3.设置打底广告的时候注意调用的渠道，如果是使用除mercury、广点通、穿山甲以外的渠道，要定义渠道的媒体id和渠道id（如果不清楚渠道id可以询问我们）参数，否则无法正确加载打底广告。设置现有渠道的广告位为打底时要保证SDK初始化时设置的媒体id和打底的广告位id匹配，否则会无法加载广告。

* 4. 自定义广告当前仅支持串行加载，暂不支持并行请求、加载SDK


## 8.异常处理

### 8.1 debug日志排查

如果集成完成，需要调试sdk请务必在**SDK初始化配置时打开debug模式**, 或者直接在需要debug的地方调用：

	AdvanceConfig.getInstance().setDebug(true)
	
然后在` Android Studio`  中的 ` Logcat` 下搜索 **advance** 关键字，即可查看SDK中所有的打印日志。

<font size=2>注： 部分手机需要在开发者选项打开日志打印开关，部分华为手机需要系统设置中开启日志打印，如果无法打印请先确认手机系统设置是否正常。</font>

	
### 8.2 Advance SDK错误码

* com.advance.model.AdvanceError 异常信息包装类

|错误码 	  | 错误详情 | 排查方向
|:------------- |:---------------|  :---------------|  
|9901| 数据为空 |广告返回的数据为空，一般为渠道广告无填充。
|9902 | 加载某个SDK渠道时发生异常| 查看logcat下日志输出，寻找具体原因
|9903 |展示某个SDK渠道时发生异常| 查看logcat下日志输出，寻找具体原因
|9904|渲染某个SDK渠道时发生异常| 查看logcat下日志输出，寻找具体原因
|9905|当前策略中无有效的SDK渠道，或渠道信息为空 | 检查聚合后台中对应广告位的渠道设置，有可能是配错渠道或者没有配置
|9906| 策略调度时发生异常 | 查看logcat下日志输出，及时反馈我们帮助排查
|9907|未获取到策略 |首先检查网络是否正常，若网络正常请检查聚合后台广告位状态是否正常，以及广告位配置是否正确，若全部配置正常，依然报此问题，请联系我们
|9908|某个SDK渠道启动异常| 查看logcat下日志输出，及时反馈我们帮助排查
|9909|穿山甲渠道SDK超时且不再加载优先级更低的渠道 | 加载超时，检查网络是否正常。仅开屏中会出现，代表开屏广告位中配置了setCsjTimeOutQuit(true)，低频可忽略
|9910 | 穿山甲渠道SDK加载超时 | 加载超时，检查网络是否正常
|9911 | 百度SDK加载失败 | 查看logcat下日志输出，寻找具体原因
|9912 | 快手SDK加载失败，广告位id类型转换异常 | 一般是广告位转换出错，检查后台配置的快手渠道下广告位id是否为纯数字，非纯数字会引起该异常。
|99_XXX | 某个SDK渠道返回的错误，其中XXX为该SDK渠道返回的具体错误码 | 翻阅各个平台下的错误码说明查找具体原因： <br/>穿山甲：[错误码说明，点击跳转](https://www.pangle.cn/union/media/union/download/detail?id=4&docId=5de8d9b925b16b00113af0ed&osType=android)<br/>广点通：[错误码说明，点击跳转](https://developers.adnet.qq.com/doc/android/union/union_debug#sdk%20%E9%94%99%E8%AF%AF%E7%A0%81)<br/>百度：[接入文档，点击跳转；错误码详见17.2](https://union.baidu.com/miniappblog/2020/06/16/AndroidSDK/) <br/>快手：无在线文档，[点击下载离线文档，查看详细错误信息](https://static.yximgs.com/udata/pkg/KS-Android-KSAdSDk/kssdk-ad-3.3.5.3-publishRelease-6d3b66a-167.zip)

### 8.3 其他异常处理

Q: 项目构建时出现 “unexpected element < queries> found in < manifest>”异常?

A: queries是Android11新引入的manifest基础成分，低版本的gradl无法识别，[点此查看详细说明](https://stackoverflow.com/questions/62969917/how-do-i-fix-unexpected-element-queries-found-in-manifest)。需要升级Android Gradle Plugin 到以下版本：
 
- 3.3.3
- 3.4.3
- 3.5.4
- 3.6.4
- 4.0.1

---

Q: 请求不到广告怎么办？

A: 首先检查广告的ID配置是否正确，如果ID正确，根据SDK返回的异常code和msg，对应错误码表来分析错误原因。

---


## 9 测试验收

为保证对接无误，接入完成并自测后，建议您提供测试包给我方对接人员进行验收。
